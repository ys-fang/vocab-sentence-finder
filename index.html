<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VocabGem - Â≠∏Ê∏¨Ëã±ÊñáË©ûÂΩô‰æãÂè•ÂØ∂Â∫´</title>
    
    <!-- Google Material Design 3 (Material You) -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Symbols+Outlined" rel="stylesheet">
    
    <!-- SheetJS library for Excel file generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <!-- docx library for Word file generation -->
    <script src="https://cdn.jsdelivr.net/npm/docx@7.8.2/build/index.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>
    
    <!-- compromise.js library for English NLP -->
    <script src="https://unpkg.com/compromise@latest/builds/compromise.min.js"></script>
    <style>
        /* Jutor.ai ÁúüÂØ¶ÈÖçËâ≤ÊñπÊ°à v2 - Êõ¥Á∞°ÊΩîÁöÑË©ÆÈáã */
        :root {
            /* Primary Colors - Jutor ËñÑËç∑Á∂†‰∏ªËâ≤Ë™ø */
            --md-sys-color-primary: #5DBEAA;
            --md-sys-color-on-primary: #FFFFFF;
            --md-sys-color-primary-container: #F0FAF9;
            --md-sys-color-on-primary-container: #2D3748;

            /* Secondary Colors - Ê∑±ÁÅ∞Ëâ≤Á≥ª for text and UI elements */
            --md-sys-color-secondary: #4A5568;
            --md-sys-color-on-secondary: #FFFFFF;
            --md-sys-color-secondary-container: #F1F5F9;
            --md-sys-color-on-secondary-container: #1A202C;

            /* Tertiary Colors - ËºîÂä©ËóçËâ≤Á≥ª from screenshot */
            --md-sys-color-tertiary: #4299E1;
            --md-sys-color-on-tertiary: #FFFFFF;
            --md-sys-color-tertiary-container: #EBF8FF;
            --md-sys-color-on-tertiary-container: #2B6CB0;

            /* Error Colors */
            --md-sys-color-error: #E53E3E;
            --md-sys-color-on-error: #FFFFFF;
            --md-sys-color-error-container: #FFF5F5;
            --md-sys-color-on-error-container: #9B2C2C;

            /* Surface Colors - Clean & white */
            --md-sys-color-surface: #FFFFFF;
            --md-sys-color-on-surface: #2D3748;
            --md-sys-color-surface-variant: #F7FAFC;
            --md-sys-color-on-surface-variant: #718096;
            --md-sys-color-surface-container: #FFFFFF;
            --md-sys-color-surface-container-low: #F7FAFC;
            --md-sys-color-surface-container-lowest: #FFFFFF;
            --md-sys-color-surface-container-high: #F7FAFC;
            --md-sys-color-surface-container-highest: #EDF2F7;

            /* Outline Colors */
            --md-sys-color-outline: #E2E8F0;
            --md-sys-color-outline-variant: #F1F5F9;

            /* Success Colors */
            --md-sys-color-success: #38A169;
            --md-sys-color-on-success: #FFFFFF;
            --md-sys-color-success-container: #F0FFF4;
            --md-sys-color-on-success-container: #276749;

            /* Warning Colors */
            --md-sys-color-warning: #D69E2E;
            --md-sys-color-on-warning: #FFFFFF;
            --md-sys-color-warning-container: #FFFAF0;
            --md-sys-color-on-warning-container: #975A16;

            /* Elevations */
            --md-sys-elevation-level0: 0px 0px 0px 0px rgba(0, 0, 0, 0.00), 0px 0px 0px 0px rgba(0, 0, 0, 0.00);
            --md-sys-elevation-level1: 0px 1px 2px 0px rgba(0, 0, 0, 0.30), 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
            --md-sys-elevation-level2: 0px 1px 2px 0px rgba(0, 0, 0, 0.30), 0px 2px 6px 2px rgba(0, 0, 0, 0.15);
            --md-sys-elevation-level3: 0px 4px 8px 3px rgba(0, 0, 0, 0.15), 0px 1px 3px 0px rgba(0, 0, 0, 0.30);
            --md-sys-elevation-level4: 0px 6px 10px 4px rgba(0, 0, 0, 0.15), 0px 2px 3px 0px rgba(0, 0, 0, 0.30);
            --md-sys-elevation-level5: 0px 8px 12px 6px rgba(0, 0, 0, 0.15), 0px 4px 4px 0px rgba(0, 0, 0, 0.30);

            /* Typography Scale */
            --md-sys-typescale-display-large-size: 57px;
            --md-sys-typescale-display-large-line-height: 64px;
            --md-sys-typescale-display-large-weight: 400;

            --md-sys-typescale-headline-large-size: 32px;
            --md-sys-typescale-headline-large-line-height: 40px;
            --md-sys-typescale-headline-large-weight: 400;

            --md-sys-typescale-title-large-size: 22px;
            --md-sys-typescale-title-large-line-height: 28px;
            --md-sys-typescale-title-large-weight: 400;

            --md-sys-typescale-title-medium-size: 16px;
            --md-sys-typescale-title-medium-line-height: 24px;
            --md-sys-typescale-title-medium-weight: 500;

            --md-sys-typescale-body-large-size: 16px;
            --md-sys-typescale-body-large-line-height: 24px;
            --md-sys-typescale-body-large-weight: 400;

            --md-sys-typescale-body-medium-size: 14px;
            --md-sys-typescale-body-medium-line-height: 20px;
            --md-sys-typescale-body-medium-weight: 400;

            --md-sys-typescale-body-small-size: 12px;
            --md-sys-typescale-body-small-line-height: 16px;
            --md-sys-typescale-body-small-weight: 400;

            --md-sys-typescale-label-large-size: 14px;
            --md-sys-typescale-label-large-line-height: 20px;
            --md-sys-typescale-label-large-weight: 500;

            /* Spacing System */
            --md-sys-spacing-xs: 4px;
            --md-sys-spacing-sm: 8px;
            --md-sys-spacing-md: 16px;
            --md-sys-spacing-lg: 24px;
            --md-sys-spacing-xl: 32px;
            --md-sys-spacing-xxl: 48px;

            /* Compact Mode Spacing - Á∑äÊπäÊ®°ÂºèÈñìË∑ù */
            --md-sys-compact-spacing-xs: 2px;
            --md-sys-compact-spacing-sm: 4px;
            --md-sys-compact-spacing-md: 8px;
            --md-sys-compact-spacing-lg: 12px;
            --md-sys-compact-spacing-xl: 16px;
            --md-sys-compact-spacing-xxl: 24px;

            /* Border Radius */
            --md-sys-shape-corner-none: 0px;
            --md-sys-shape-corner-extra-small: 4px;
            --md-sys-shape-corner-small: 8px;
            --md-sys-shape-corner-medium: 12px;
            --md-sys-shape-corner-large: 16px;
            --md-sys-shape-corner-extra-large: 28px;
            --md-sys-shape-corner-full: 50%;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans TC', 'Roboto', -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            background: var(--md-sys-color-surface-container-low);
            color: var(--md-sys-color-on-surface);
            min-height: 100vh;
            padding: var(--md-sys-spacing-md);
            font-size: var(--md-sys-typescale-body-large-size);
            line-height: var(--md-sys-typescale-body-large-line-height);
            font-weight: var(--md-sys-typescale-body-large-weight);
        }

        /* Material Icons ÂÖ®ÂüüÊ®£Âºè */
        .material-icons,
        .material-icons-outlined,
        .material-symbols-outlined {
            font-family: 'Material Symbols Outlined', 'Material Icons Outlined', 'Material Icons';
            font-weight: normal;
            font-style: normal;
            font-size: 20px;
            line-height: 1;
            letter-spacing: normal;
            text-transform: none;
            display: inline-block;
            white-space: nowrap;
            word-wrap: normal;
            direction: ltr;
            -webkit-font-feature-settings: 'liga';
            font-feature-settings: 'liga';
            -webkit-font-smoothing: antialiased;
            vertical-align: middle;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: var(--md-sys-color-surface-container-lowest);
            border-radius: var(--md-sys-shape-corner-extra-large);
            box-shadow: var(--md-sys-elevation-level2);
        }

        .header {
            background: var(--md-sys-color-surface-container-low);
            color: var(--md-sys-color-on-surface);
            padding: var(--md-sys-spacing-xxl) var(--md-sys-spacing-xl);
            text-align: center;
            position: relative;
            overflow: hidden;
            border-radius: var(--md-sys-shape-corner-extra-large) var(--md-sys-shape-corner-extra-large) 0 0;
        }

        .header::before {
            display: none;
        }

        .header h1 {
            font-size: var(--md-sys-typescale-headline-large-size);
            line-height: var(--md-sys-typescale-headline-large-line-height);
            font-weight: var(--md-sys-typescale-headline-large-weight);
            margin-bottom: var(--md-sys-spacing-sm);
            position: relative;
            z-index: 1;
            color: var(--md-sys-color-primary);
        }

        .header p {
            font-size: var(--md-sys-typescale-body-large-size);
            line-height: var(--md-sys-typescale-body-large-line-height);
            opacity: 0.87;
            position: relative;
            z-index: 1;
            color: var(--md-sys-color-on-surface-variant);
        }

        .controls {
            position: sticky;
            top: 0;
            z-index: 100;
            padding: var(--md-sys-spacing-xl);
            background: var(--md-sys-color-surface);
            border-bottom: 1px solid var(--md-sys-color-outline);
            box-shadow: none;
            transition: all 0.3s cubic-bezier(0.2, 0.0, 0, 1.0);
        }

        .controls.scrolled {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border-bottom-color: transparent;
            box-shadow: var(--md-sys-elevation-level2);
        }

        .search-section {
            display: flex;
            gap: var(--md-sys-spacing-md);
            margin-bottom: var(--md-sys-spacing-lg);
            flex-wrap: wrap;
        }

        .search-box {
            flex: 1;
            min-width: 300px;
            position: relative;
        }

        .search-input {
            width: 100%;
            padding: var(--md-sys-spacing-md) var(--md-sys-spacing-lg);
            border: 1px solid var(--md-sys-color-outline);
            border-radius: var(--md-sys-shape-corner-extra-large);
            font-size: var(--md-sys-typescale-body-large-size);
            line-height: var(--md-sys-typescale-body-large-line-height);
            font-family: inherit;
            background: var(--md-sys-color-surface-container-lowest);
            color: var(--md-sys-color-on-surface);
            transition: all 0.2s cubic-bezier(0.2, 0.0, 0, 1.0);
            box-shadow: var(--md-sys-elevation-level0);
            min-height: 48px;
            box-sizing: border-box;
        }

        .search-input:hover {
            border-color: var(--md-sys-color-on-surface);
            box-shadow: var(--md-sys-elevation-level1);
        }

        .search-input:focus {
            outline: none;
            border-color: var(--md-sys-color-primary);
            box-shadow: 0 0 0 2px rgba(78, 205, 196, 0.12);
            background: var(--md-sys-color-surface);
        }

        .word-search-input {
            border-color: var(--md-sys-color-success);
            background: var(--md-sys-color-success-container);
            color: var(--md-sys-color-on-success-container);
        }

        .word-search-input:hover {
            border-color: var(--md-sys-color-success);
        }

        .word-search-input:focus {
            border-color: var(--md-sys-color-success);
            box-shadow: 0 0 0 2px rgba(56, 161, 105, 0.12);
        }

        .word-match {
            background-color: var(--md-sys-color-warning-container);
            color: var(--md-sys-color-on-warning-container);
            border-radius: var(--md-sys-shape-corner-extra-small);
            padding: 2px 6px;
            font-weight: var(--md-sys-typescale-label-large-weight);
            box-decoration-break: clone;
            -webkit-box-decoration-break: clone;
        }

        .search-mode-indicator {
            margin-top: var(--md-sys-spacing-sm);
            padding: var(--md-sys-spacing-sm) var(--md-sys-spacing-md);
            background: var(--md-sys-color-secondary-container);
            color: var(--md-sys-color-on-secondary-container);
            border-radius: var(--md-sys-shape-corner-small);
            font-size: var(--md-sys-typescale-body-medium-size);
            line-height: var(--md-sys-typescale-body-medium-line-height);
            display: none;
        }



        /* ÈüøÊáâÂºèÁØ©ÈÅ∏Âô®ÂÆπÂô® */
        .filter-container {
            margin-top: var(--md-sys-spacing-md);
        }

        /* ÁØ©ÈÅ∏Âô®ÂÖßÂÆπÂçÄÂüü */
        .filter-content {
            padding: var(--md-sys-spacing-lg);
            background: var(--md-sys-color-surface-container-lowest);
            border: 1px solid var(--md-sys-color-outline-variant);
            border-radius: var(--md-sys-shape-corner-medium);
            box-shadow: var(--md-sys-elevation-level1);
        }

        .filter-drawer-toggle {
            display: flex;
            align-items: center;
            gap: var(--md-sys-spacing-sm);
            padding: var(--md-sys-spacing-md) var(--md-sys-spacing-lg);
            background: var(--md-sys-color-surface-container-low);
            border: 1px solid var(--md-sys-color-outline);
            border-radius: var(--md-sys-shape-corner-medium);
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.2, 0.0, 0, 1.0);
            user-select: none;
            font-size: var(--md-sys-typescale-body-large-size);
            color: var(--md-sys-color-on-surface);
            justify-content: center;
        }

        /* Ê°åÈù¢ÁâàÊ®£ÂºèÔºöÁõ¥Êé•È°ØÁ§∫ÂÖßÂÆπÔºåÈö±ËóèÂàáÊèõÊåâÈàï */
        @media (min-width: 600px) {
            .filter-drawer-toggle {
                display: none !important;
            }
            
            .filter-content {
                display: block !important;
                margin-top: 0 !important;
            }
            
            /* Ê°åÈù¢ÁâàÁØ©ÈÅ∏Âô®ÂÆπÂô®Áõ¥Êé•È°ØÁ§∫ÂÖßÂÆπÔºå‰∏çÈúÄË¶ÅÊäΩÂ±úÂ§ñËßÄ */
            .filter-container {
                margin-top: var(--md-sys-spacing-md);
            }
        }

        .filter-drawer-toggle:hover {
            background: var(--md-sys-color-surface-container);
            border-color: var(--md-sys-color-on-surface);
        }

        .filter-drawer-toggle .material-symbols-outlined:first-child {
            font-size: 20px;
            color: var(--md-sys-color-primary);
        }

        .filter-arrow {
            transition: transform 0.2s cubic-bezier(0.2, 0.0, 0, 1.0);
            font-size: 18px !important;
            color: var(--md-sys-color-on-surface-variant) !important;
        }

        .filter-drawer-toggle[aria-expanded="true"] .filter-arrow {
            transform: rotate(180deg);
        }

        .filter-drawer-content {
            margin-top: var(--md-sys-spacing-sm);
            padding: var(--md-sys-spacing-lg);
            background: var(--md-sys-color-surface-container-lowest);
            border: 1px solid var(--md-sys-color-outline-variant);
            border-radius: var(--md-sys-shape-corner-medium);
            box-shadow: var(--md-sys-elevation-level1);
        }

        /* Ë§áÈÅ∏ÁØ©ÈÅ∏Âô®Ê®£Âºè */
        .multiselect-container {
            position: relative;
            display: inline-block;
            min-width: 180px;
        }

        .multiselect-toggle {
            padding: var(--md-sys-spacing-md) var(--md-sys-spacing-lg);
            border: 1px solid var(--md-sys-color-outline);
            border-radius: var(--md-sys-shape-corner-medium);
            background: var(--md-sys-color-surface-container-lowest);
            color: var(--md-sys-color-on-surface);
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            user-select: none;
            font-size: var(--md-sys-typescale-body-large-size);
            line-height: var(--md-sys-typescale-body-large-line-height);
            transition: all 0.2s cubic-bezier(0.2, 0.0, 0, 1.0);
            box-shadow: var(--md-sys-elevation-level0);
            min-height: 48px;
        }

        .multiselect-toggle[disabled] {
            background: var(--md-sys-color-surface-variant);
            color: var(--md-sys-color-on-surface-variant);
            cursor: not-allowed;
            opacity: 0.38;
        }

        .multiselect-toggle:hover:not([disabled]) {
            border-color: var(--md-sys-color-on-surface);
            box-shadow: var(--md-sys-elevation-level1);
        }

        .multiselect-arrow {
            transition: transform 0.2s cubic-bezier(0.2, 0.0, 0, 1.0);
            color: var(--md-sys-color-on-surface-variant);
            font-size: 18px;
        }

        .multiselect-dropdown[style*="block"] + .multiselect-toggle .multiselect-arrow,
        .multiselect-toggle[aria-expanded="true"] .multiselect-arrow {
            transform: rotate(180deg);
        }

        .multiselect-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: var(--md-sys-color-surface-container);
            border: 1px solid var(--md-sys-color-outline-variant);
            border-radius: var(--md-sys-shape-corner-medium);
            max-height: 240px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
            box-shadow: var(--md-sys-elevation-level2);
            margin-top: var(--md-sys-spacing-xs);
        }

        .multiselect-option {
            padding: var(--md-sys-spacing-md);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: var(--md-sys-spacing-md);
            font-size: var(--md-sys-typescale-body-large-size);
            line-height: var(--md-sys-typescale-body-large-line-height);
            color: var(--md-sys-color-on-surface);
            transition: background-color 0.2s cubic-bezier(0.2, 0.0, 0, 1.0);
        }

        .multiselect-option:hover {
            background: var(--md-sys-color-surface-container-high);
        }

        .multiselect-option:first-child {
            border-radius: var(--md-sys-shape-corner-medium) var(--md-sys-shape-corner-medium) 0 0;
        }

        .multiselect-option:last-child {
            border-radius: 0 0 var(--md-sys-shape-corner-medium) var(--md-sys-shape-corner-medium);
        }

        .multiselect-option input[type="checkbox"] {
            margin: 0;
            width: 18px;
            height: 18px;
            accent-color: var(--md-sys-color-primary);
        }

        /* ÁµêÊûúÊìç‰ΩúÊåâÈàïÊ®£Âºè */
        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
        }

        .results-actions {
            display: flex;
            gap: var(--md-sys-spacing-sm);
            align-items: center;
        }

        .action-button {
            padding: var(--md-sys-spacing-sm) var(--md-sys-spacing-lg);
            border: none;
            border-radius: var(--md-sys-shape-corner-large);
            cursor: pointer;
            font-size: var(--md-sys-typescale-label-large-size);
            font-weight: var(--md-sys-typescale-label-large-weight);
            font-family: inherit;
            transition: all 0.2s cubic-bezier(0.2, 0.0, 0, 1.0);
            display: flex;
            align-items: center;
            gap: var(--md-sys-spacing-sm);
            min-height: 40px;
            position: relative;
            overflow: hidden;
        }

        .action-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: currentColor;
            opacity: 0;
            transition: opacity 0.2s cubic-bezier(0.2, 0.0, 0, 1.0);
        }

        .action-button:hover::before {
            opacity: 0.08;
        }

        .action-button:focus::before {
            opacity: 0.12;
        }

        .action-button:active::before {
            opacity: 0.16;
        }

        .download-dropdown {
            position: relative;
        }

        .download-button {
            background: var(--md-sys-color-primary);
            color: var(--md-sys-color-on-primary);
            box-shadow: none;
        }

        .download-button:hover {
            box-shadow: none;
            filter: brightness(90%);
        }

        .download-button:active {
            box-shadow: none;
            filter: brightness(85%);
        }

        .download-button .material-symbols-outlined {
            font-size: 18px;
        }

        .download-menu {
            position: absolute;
            top: calc(100% + var(--md-sys-spacing-xs));
            right: 0;
            background: var(--md-sys-color-surface-container);
            border: 1px solid var(--md-sys-color-outline-variant);
            border-radius: var(--md-sys-shape-corner-medium);
            box-shadow: var(--md-sys-elevation-level2);
            z-index: 1000;
            display: none;
            min-width: 180px;
            overflow: hidden;
        }

        .download-option {
            display: flex;
            align-items: center;
            gap: var(--md-sys-spacing-md);
            width: 100%;
            padding: var(--md-sys-spacing-md) var(--md-sys-spacing-lg);
            border: none;
            background: none;
            text-align: left;
            cursor: pointer;
            font-size: var(--md-sys-typescale-body-large-size);
            line-height: var(--md-sys-typescale-body-large-line-height);
            color: var(--md-sys-color-on-surface);
            font-family: inherit;
            transition: background-color 0.2s cubic-bezier(0.2, 0.0, 0, 1.0);
            position: relative;
            overflow: hidden;
        }

        .download-option .material-symbols-outlined {
            color: var(--md-sys-color-on-surface-variant);
            flex-shrink: 0;
            font-size: 18px;
        }

        .download-option::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: currentColor;
            opacity: 0;
            transition: opacity 0.2s cubic-bezier(0.2, 0.0, 0, 1.0);
        }

        .download-option:hover::before {
            opacity: 0.08;
        }

        .download-option:focus::before {
            opacity: 0.12;
        }

        .download-option:active::before {
            opacity: 0.16;
        }

        /* Á¶ÅÁî®ÁãÄÊÖãÊ®£Âºè */
        input:disabled {
            background: var(--md-sys-color-surface-variant);
            color: var(--md-sys-color-on-surface-variant);
            cursor: not-allowed;
            opacity: 0.38;
        }

        .filter-section {
            display: flex;
            gap: var(--md-sys-spacing-lg);
            flex-wrap: wrap;
        }

        .filter-group {
            display: flex;
            align-items: center;
            gap: var(--md-sys-spacing-md);
        }

        .filter-label {
            font-weight: var(--md-sys-typescale-title-medium-weight);
            font-size: var(--md-sys-typescale-title-medium-size);
            line-height: var(--md-sys-typescale-title-medium-line-height);
            color: var(--md-sys-color-on-surface);
            white-space: nowrap;
        }

        .filter-select {
            padding: var(--md-sys-spacing-md);
            border: 1px solid var(--md-sys-color-outline);
            border-radius: var(--md-sys-shape-corner-medium);
            background: var(--md-sys-color-surface-container-lowest);
            color: var(--md-sys-color-on-surface);
            font-size: var(--md-sys-typescale-body-large-size);
            font-family: inherit;
            min-width: 140px;
            transition: all 0.2s cubic-bezier(0.2, 0.0, 0, 1.0);
        }

        .filter-select:hover {
            border-color: var(--md-sys-color-on-surface);
        }

        .filter-select:focus {
            outline: none;
            border-color: var(--md-sys-color-primary);
            box-shadow: 0 0 0 2px rgba(78, 205, 196, 0.12);
        }

        .status-section {
            margin-top: var(--md-sys-spacing-lg);
            padding: 0;
            background: transparent;
            text-align: center;
            position: relative;
            z-index: 1;
        }

        .status-text {
            color: var(--md-sys-color-on-primary-container);
            font-weight: var(--md-sys-typescale-body-medium-weight);
            font-size: var(--md-sys-typescale-body-small-size);
            line-height: var(--md-sys-typescale-body-small-line-height);
            opacity: 0.8;
            margin-bottom: var(--md-sys-spacing-xs);
        }

        .cache-status {
            margin-top: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: var(--md-sys-spacing-md);
            padding: 0;
            background: transparent;
        }

        .cache-indicator {
            font-size: var(--md-sys-typescale-body-small-size);
            line-height: var(--md-sys-typescale-body-small-line-height);
            color: var(--md-sys-color-on-primary-container);
            opacity: 0.7;
        }

        .cache-indicator.using-cache {
            color: var(--md-sys-color-success);
            opacity: 0.8;
        }

        .cache-indicator.old-cache {
            color: var(--md-sys-color-warning);
            opacity: 0.8;
        }

        .refresh-button {
            padding: var(--md-sys-spacing-xs) var(--md-sys-spacing-sm);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: var(--md-sys-shape-corner-medium);
            background: rgba(255, 255, 255, 0.1);
            color: var(--md-sys-color-on-primary-container);
            cursor: pointer;
            font-size: var(--md-sys-typescale-body-small-size);
            font-weight: var(--md-sys-typescale-body-small-weight);
            font-family: inherit;
            transition: all 0.2s cubic-bezier(0.2, 0.0, 0, 1.0);
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--md-sys-spacing-xs);
            min-height: 28px;
            opacity: 0.7;
        }

        .refresh-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: currentColor;
            opacity: 0;
            transition: opacity 0.2s cubic-bezier(0.2, 0.0, 0, 1.0);
        }

        .refresh-button:hover {
            opacity: 1;
            border-color: rgba(255, 255, 255, 0.5);
            background: rgba(255, 255, 255, 0.2);
        }

        .refresh-button:hover::before {
            opacity: 0.08;
        }

        .refresh-button:focus::before {
            opacity: 0.12;
        }

        .refresh-button:active::before {
            opacity: 0.16;
        }

        .refresh-button:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .refresh-button:disabled::before {
            display: none;
        }

        .refresh-button .material-symbols-outlined {
            font-size: 16px;
        }

        .loading {
            display: none;
            text-align: center;
            padding: var(--md-sys-spacing-xl);
        }

        .spinner {
            border: 4px solid var(--md-sys-color-surface-variant);
            border-top: 4px solid var(--md-sys-color-primary);
            border-radius: 50%;
            width: 48px;
            height: 48px;
            animation: spin 1s linear infinite;
            margin: 0 auto var(--md-sys-spacing-lg);
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .content {
            padding: var(--md-sys-spacing-xl);
            margin-top: 0;
            background: var(--md-sys-color-surface);
            border-radius: 0 0 var(--md-sys-shape-corner-extra-large) var(--md-sys-shape-corner-extra-large);
        }

        /* Á¢∫‰øùÁµêÊûúÂçÄÂüüÊúâË∂≥Â§†ÁöÑÁ©∫ÈñìÔºå‰∏çÊúÉË¢´Âõ∫ÂÆöÊéßÂà∂ÂçÄÂüüÊìã‰Ωè */
        .results-container {
            margin-top: var(--md-sys-spacing-lg);
        }

        /* Âπ≥ÊªëÊªæÂãïÊïàÊûú */
        html {
            scroll-behavior: smooth;
        }

        .results-info {
            margin-top: var(--md-sys-spacing-lg);
            padding: var(--md-sys-spacing-md) var(--md-sys-spacing-lg);
            background: var(--md-sys-color-success-container);
            color: var(--md-sys-color-on-success-container);
            border-radius: var(--md-sys-shape-corner-medium);
            border-left: 4px solid var(--md-sys-color-success);
        }

        .results-count {
            font-weight: var(--md-sys-typescale-title-medium-weight);
            font-size: var(--md-sys-typescale-title-medium-size);
            line-height: var(--md-sys-typescale-title-medium-line-height);
            color: var(--md-sys-color-on-success-container);
        }

        .results-table {
            width: 100%;
            border-collapse: collapse;
            background: var(--md-sys-color-surface-container-lowest);
            border-radius: var(--md-sys-shape-corner-large);
            overflow: hidden;
            box-shadow: none;
            border: 1px solid var(--md-sys-color-outline);
            table-layout: fixed;
        }

        .results-table th:nth-child(1), 
        .results-table td:nth-child(1) {
            width: 8%;
            min-width: 60px;
        }

        .results-table th:nth-child(2), 
        .results-table td:nth-child(2) {
            width: 15%;
            min-width: 120px;
        }

        .results-table th:nth-child(3), 
        .results-table td:nth-child(3) {
            width: 17%;
            min-width: 140px;
        }

        .results-table th:nth-child(4), 
        .results-table td:nth-child(4) {
            width: 35%;
        }

        .results-table th:nth-child(5), 
        .results-table td:nth-child(5) {
            width: 25%;
        }

        .results-table th {
            background: var(--md-sys-color-surface-container-low);
            color: var(--md-sys-color-on-surface-variant);
            padding: var(--md-sys-spacing-lg);
            text-align: left;
            font-weight: var(--md-sys-typescale-title-medium-weight);
            font-size: var(--md-sys-typescale-body-medium-size);
            line-height: var(--md-sys-typescale-title-medium-line-height);
            border-bottom: 1px solid var(--md-sys-color-outline);
        }

        .results-table td {
            padding: var(--md-sys-spacing-lg);
            border-bottom: 1px solid var(--md-sys-color-outline);
            vertical-align: top;
            color: var(--md-sys-color-on-surface);
        }

        .results-table tbody tr:last-child td {
            border-bottom: none;
        }

        .results-table tr:hover {
            background: var(--md-sys-color-primary-container);
        }

        .sentence-cell {
            max-width: 500px;
            line-height: var(--md-sys-typescale-body-large-line-height);
            position: relative;
        }

        .sentence-content {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: var(--md-sys-spacing-md);
        }

        .sentence-text {
            flex: 1;
            font-size: var(--md-sys-typescale-body-large-size);
            line-height: var(--md-sys-typescale-body-large-line-height);
        }

        .copy-sentence-btn {
            background: none;
            border: none;
            cursor: pointer;
            color: var(--md-sys-color-on-surface-variant);
            padding: 0;
            border-radius: 50%;
            transition: all 0.2s cubic-bezier(0.2, 0.0, 0, 1.0);
            display: flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 32px;
            flex-shrink: 0;
            position: relative;
            overflow: hidden;
        }

        .copy-sentence-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: currentColor;
            opacity: 0;
            border-radius: inherit;
            transition: opacity 0.2s cubic-bezier(0.2, 0.0, 0, 1.0);
        }

        .copy-sentence-btn:hover {
            color: var(--md-sys-color-on-surface);
        }

        .copy-sentence-btn:hover::before {
            opacity: 0.08;
        }

        .copy-sentence-btn:focus::before {
            opacity: 0.12;
        }

        .copy-sentence-btn:active::before {
            opacity: 0.16;
        }

        .copy-sentence-btn.copied {
            color: var(--md-sys-color-success);
        }

        .copy-sentence-btn .material-symbols-outlined {
            font-size: 18px;
        }

        .translation-cell {
            max-width: 500px;
            line-height: var(--md-sys-typescale-body-large-line-height);
            color: var(--md-sys-color-on-surface-variant);
            font-size: var(--md-sys-typescale-body-large-size);
        }

        .year-badge {
            background: var(--md-sys-color-tertiary-container);
            color: var(--md-sys-color-on-tertiary-container);
            padding: var(--md-sys-spacing-xs) var(--md-sys-spacing-sm);
            border-radius: var(--md-sys-shape-corner-small);
            font-size: var(--md-sys-typescale-body-small-size);
            font-weight: var(--md-sys-typescale-label-large-weight);
            line-height: var(--md-sys-typescale-label-large-line-height);
            font-family: inherit;
        }

        .part-badge {
            background: var(--md-sys-color-secondary-container);
            color: var(--md-sys-color-on-secondary-container);
            padding: var(--md-sys-spacing-xs) var(--md-sys-spacing-sm);
            border-radius: var(--md-sys-shape-corner-small);
            font-size: var(--md-sys-typescale-body-small-size);
            font-weight: var(--md-sys-typescale-label-large-weight);
            line-height: var(--md-sys-typescale-label-large-line-height);
            font-family: inherit;
            white-space: nowrap;
            display: inline-block;
            max-width: 100%;
            overflow: hidden;
            text-overflow: ellipsis;
            cursor: help;
            transition: all 0.2s cubic-bezier(0.2, 0.0, 0, 1.0);
        }

        .part-badge:hover {
            background: var(--md-sys-color-secondary-container);
            color: var(--md-sys-color-on-secondary-container);
            transform: scale(1.02);
            filter: brightness(95%);
        }

        .no-results {
            text-align: center;
            padding: var(--md-sys-spacing-xxl);
            color: var(--md-sys-color-on-surface-variant);
            font-size: var(--md-sys-typescale-title-large-size);
            line-height: var(--md-sys-typescale-title-large-line-height);
        }

        .error-message {
            background: var(--md-sys-color-error-container);
            color: var(--md-sys-color-on-error-container);
            padding: var(--md-sys-spacing-lg);
            border-radius: var(--md-sys-shape-corner-medium);
            border-left: 4px solid var(--md-sys-color-error);
            margin-bottom: var(--md-sys-spacing-lg);
            font-size: var(--md-sys-typescale-body-large-size);
            line-height: var(--md-sys-typescale-body-large-line-height);
        }

        /* Mobile-first responsive design */
        @media (max-width: 599px) {
            body {
                padding: var(--md-sys-spacing-sm);
            }

            /* ÊâãÊ©üÁâàÈö±ËóèÊêúÂ∞ãÁãÄÊÖãË™™Êòé */
            .search-mode-indicator {
                display: none !important;
            }

            /* ÊâãÊ©üÁâàÁØ©ÈÅ∏Âô®ÂÖßÂÆπÈ†êË®≠Èö±Ëóè */
            .filter-content {
                display: none;
            }

            .header {
                padding: var(--md-sys-spacing-lg) var(--md-sys-spacing-md);
            }

            .header h1 {
                font-size: var(--md-sys-typescale-title-large-size);
                line-height: var(--md-sys-typescale-title-large-line-height);
            }

            .controls {
                padding: var(--md-sys-spacing-lg) var(--md-sys-spacing-md);
            }

            .controls.scrolled {
                padding: var(--md-sys-spacing-md);
            }
            
            .search-section {
                flex-direction: column;
                gap: var(--md-sys-spacing-md);
            }
            
            .search-box {
                min-width: auto;
            }
            
            .filter-section {
                flex-direction: column;
                align-items: stretch;
                gap: var(--md-sys-spacing-md);
            }

            .filter-group {
                flex-direction: column;
                align-items: stretch;
                gap: var(--md-sys-spacing-sm);
            }

            .filter-drawer-content .filter-section {
                flex-direction: column;
                gap: var(--md-sys-spacing-lg);
            }

            .multiselect-container {
                min-width: auto;
                width: 100%;
            }

            .content {
                padding: var(--md-sys-spacing-md);
                min-height: calc(100vh - 180px);
            }
            
            .results-table {
                font-size: var(--md-sys-typescale-body-medium-size);
                display: block;
                overflow-x: auto;
                white-space: nowrap;
            }

            /* ÊâãÊ©üÁâàÈö±ËóèÈÉ®ÂàÜÊ¨Ñ‰Ωç */
            .results-table th:nth-child(3), /* ‰æÜÊ∫ê */
            .results-table td:nth-child(3),
            .results-table th:nth-child(5), /* ‰æãÂè•ÁøªË≠Ø */
            .results-table td:nth-child(5) {
                display: none;
            }
            
            .results-table th,
            .results-table td {
                padding: var(--md-sys-spacing-md);
            }

            .results-table th:nth-child(1), 
            .results-table td:nth-child(1) {
                min-width: 50px;
                width: 10%;
            }

            .results-table th:nth-child(2), 
            .results-table td:nth-child(2) {
                min-width: 100px;
                width: 20%;
            }

            .results-table th:nth-child(3), 
            .results-table td:nth-child(3) {
                min-width: 120px;
                width: 25%;
            }

            .sentence-cell,
            .translation-cell {
                max-width: 280px;
                white-space: normal;
            }

            .results-header {
                flex-direction: column;
                gap: var(--md-sys-spacing-md);
                align-items: stretch;
            }

            .results-actions {
                flex-direction: column;
                gap: var(--md-sys-spacing-sm);
                align-items: stretch;
            }

            .action-button {
                justify-content: center;
            }

            .cache-status {
                flex-direction: column;
                gap: var(--md-sys-spacing-sm);
                align-items: stretch;
            }

            .refresh-button {
                align-self: center;
                min-width: 140px;
            }



            .download-menu {
                position: fixed;
                top: auto;
                bottom: var(--md-sys-spacing-md);
                left: var(--md-sys-spacing-md);
                right: var(--md-sys-spacing-md);
                min-width: auto;
            }
        }

        /* Tablet responsive design */
        @media (min-width: 600px) and (max-width: 1023px) {
            .container {
                margin: 0 var(--md-sys-spacing-md);
            }

            .sentence-cell,
            .translation-cell {
                max-width: 350px;
            }

            .results-table th,
            .results-table td {
                padding: var(--md-sys-spacing-lg) var(--md-sys-spacing-md);
            }
        }

        /* Desktop enhancements */

        @media (min-width: 1024px) {
            .sentence-cell,
            .translation-cell {
                max-width: 600px;
            }

            .results-table th,
            .results-table td {
                padding: var(--md-sys-spacing-lg);
            }
        }

        .site-footer {
            text-align: center;
            padding: var(--md-sys-spacing-lg);
            color: var(--md-sys-color-on-surface-variant);
            font-size: var(--md-sys-typescale-body-medium-size);
        }

        /* ========================================
           Á∑äÊπäÊ™¢Ë¶ñÊ®°Âºè - Compact View Mode
           ======================================== */
        
        /* Á∑äÊπäÊ®°ÂºèÂàáÊèõÊåâÈàï */
        .compact-toggle {
            position: fixed;
            top: 20px;
            right: 24px;
            z-index: 1000;
            background: var(--md-sys-color-primary);
            color: var(--md-sys-color-on-primary);
            border: none;
            border-radius: var(--md-sys-shape-corner-full);
            width: 48px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: var(--md-sys-elevation-level3);
            transition: all 0.2s cubic-bezier(0.2, 0.0, 0, 1.0);
            font-size: 20px;
        }

        .compact-toggle:hover {
            background: var(--md-sys-color-primary-container);
            color: var(--md-sys-color-on-primary-container);
            transform: scale(1.05);
        }

        /* Á∑äÊπäÊ®°Âºè‰∏ªÈ´îÊ®£Âºè */
        body.compact-mode .header {
            padding: var(--md-sys-compact-spacing-lg) var(--md-sys-compact-spacing-xl);
        }

        body.compact-mode .header h1 {
            font-size: var(--md-sys-typescale-title-large-size);
            line-height: var(--md-sys-typescale-title-large-line-height);
            margin-bottom: var(--md-sys-compact-spacing-xs);
        }

        body.compact-mode .header p {
            font-size: var(--md-sys-typescale-body-medium-size);
            line-height: var(--md-sys-typescale-body-medium-line-height);
            margin-bottom: var(--md-sys-compact-spacing-sm);
        }

        body.compact-mode .controls {
            padding: var(--md-sys-compact-spacing-lg);
        }

        body.compact-mode .search-section {
            gap: var(--md-sys-compact-spacing-sm);
            margin-bottom: var(--md-sys-compact-spacing-md);
        }

        body.compact-mode .search-input {
            padding: var(--md-sys-compact-spacing-sm) var(--md-sys-compact-spacing-md);
            font-size: var(--md-sys-typescale-body-medium-size);
            min-height: 36px;
        }

        body.compact-mode .search-mode-indicator {
            margin-top: var(--md-sys-compact-spacing-xs);
            padding: var(--md-sys-compact-spacing-xs) var(--md-sys-compact-spacing-sm);
            font-size: var(--md-sys-typescale-body-small-size);
        }

        body.compact-mode .filter-container {
            margin-top: var(--md-sys-compact-spacing-sm);
        }

        body.compact-mode .filter-drawer-toggle {
            gap: var(--md-sys-compact-spacing-xs);
            padding: var(--md-sys-compact-spacing-sm) var(--md-sys-compact-spacing-md);
        }

        body.compact-mode .filter-section {
            padding: var(--md-sys-compact-spacing-md);
        }

        body.compact-mode .filter-group {
            gap: var(--md-sys-compact-spacing-sm);
        }

        body.compact-mode .multiselect-toggle {
            padding: var(--md-sys-compact-spacing-sm) var(--md-sys-compact-spacing-md);
            min-height: 32px;
        }

        body.compact-mode .multiselect-option {
            padding: var(--md-sys-compact-spacing-sm);
            font-size: var(--md-sys-typescale-body-small-size);
        }

        body.compact-mode .results-info {
            margin-top: var(--md-sys-compact-spacing-md);
            padding: var(--md-sys-compact-spacing-sm) var(--md-sys-compact-spacing-md);
        }

        body.compact-mode .results-header {
            gap: var(--md-sys-compact-spacing-md);
        }

        body.compact-mode .action-button {
            gap: var(--md-sys-compact-spacing-xs);
            padding: var(--md-sys-compact-spacing-xs) var(--md-sys-compact-spacing-md);
            min-height: 32px;
            font-size: var(--md-sys-typescale-body-small-size);
        }

        body.compact-mode .download-option {
            gap: var(--md-sys-compact-spacing-sm);
            padding: var(--md-sys-compact-spacing-sm) var(--md-sys-compact-spacing-md);
            font-size: var(--md-sys-typescale-body-small-size);
        }

        body.compact-mode .results-table th {
            padding: var(--md-sys-compact-spacing-md);
            font-size: var(--md-sys-typescale-body-small-size);
        }

        body.compact-mode .results-table td {
            padding: var(--md-sys-compact-spacing-md);
            font-size: var(--md-sys-typescale-body-small-size);
            line-height: var(--md-sys-typescale-body-small-line-height);
        }

        body.compact-mode .sentence-content {
            gap: var(--md-sys-compact-spacing-sm);
        }

        body.compact-mode .copy-sentence-btn {
            padding: var(--md-sys-compact-spacing-xs);
            width: 24px;
            height: 24px;
            font-size: 16px;
        }

        body.compact-mode .status-section {
            margin-top: var(--md-sys-compact-spacing-sm);
        }

        body.compact-mode .status-text {
            margin-bottom: var(--md-sys-compact-spacing-xs);
            font-size: var(--md-sys-typescale-body-small-size);
        }

        body.compact-mode .cache-status {
            gap: var(--md-sys-compact-spacing-sm);
        }

        body.compact-mode .refresh-button {
            gap: var(--md-sys-compact-spacing-xs);
            padding: var(--md-sys-compact-spacing-xs) var(--md-sys-compact-spacing-sm);
            min-height: 24px;
            font-size: var(--md-sys-typescale-body-small-size);
        }

        /* Á∑äÊπäÊ®°ÂºèÈüøÊáâÂºèË™øÊï¥ */
        @media (max-width: 599px) {
            body.compact-mode .header {
                padding: var(--md-sys-compact-spacing-md);
            }
            
            body.compact-mode .controls {
                padding: var(--md-sys-compact-spacing-sm);
            }
            
            body.compact-mode .search-input {
                padding: var(--md-sys-compact-spacing-xs) var(--md-sys-compact-spacing-sm);
                min-height: 32px;
            }
            
            body.compact-mode .results-table th,
            body.compact-mode .results-table td {
                padding: var(--md-sys-compact-spacing-sm);
            }
        }
    </style>
</head>
<body>
    <!-- Á∑äÊπäÊ®°ÂºèÂàáÊèõÊåâÈàï -->
    <button class="compact-toggle" id="compactToggle" title="ÂàáÊèõÁ∑äÊπäÊ™¢Ë¶ñÊ®°Âºè">
        <span class="material-symbols-outlined">compress</span>
    </button>

    <div class="container">
        <div class="header">
            <h1>VocabGem <span style="font-size: 0.7em; color: var(--md-sys-color-on-surface-variant);">Ë©ûÂΩôÂØ∂Áü≥</span></h1>
            <p>ÊåñÊéòÂ≠∏Ê∏¨Ëã±ÊñáËÄÉÈ°å‰∏≠ÁöÑË©ûÂΩôÂØ∂Ëóè - ÊØèÂÄã‰æãÂè•ÈÉΩÊòØÁèçË≤¥ÁöÑÂ≠∏ÁøíË≥áÊ∫ê</p>
            
            <div class="status-section">
                <div class="status-text" id="statusText">Ê∫ñÂÇôËºâÂÖ•Ë≥áÊñô...</div>
                <div class="cache-status" id="cacheStatus" style="display: none;">
                    <span id="cacheIndicator"></span>
                    <button id="refreshButton" class="refresh-button" title="ÈáçÊñ∞ËºâÂÖ•ÊúÄÊñ∞Ë≥áÊñô">
                        <span class="material-symbols-outlined">refresh</span>
                        ÈáçÊñ∞ËºâÂÖ•
                    </button>
                </div>
            </div>
        </div>

        <div class="controls">
            <div class="search-section">
                <div class="search-box">
                    <input type="text" id="wordSearchInput" class="search-input word-search-input" placeholder="Ëº∏ÂÖ•ÂñÆÂ≠óÔºåÂú® VocabGem ‰∏≠ÊåñÊéòÁèçË≤¥ÁöÑ‰æãÂè•ÂØ∂Áü≥ üíé" disabled>
                </div>
            </div>

            <!-- ÊêúÂ∞ãÁãÄÊÖãÊåáÁ§∫Âô®ÁßªÂà∞ÊêúÂ∞ãÊ°Ü‰∏ãÊñπ -->
            <div class="search-mode-indicator" id="searchModeIndicator"></div>

            <!-- ÈüøÊáâÂºèÁØ©ÈÅ∏Âô®ÂÆπÂô® -->
            <div class="filter-container" id="filterContainer" style="display: none;">
                <!-- ÊâãÊ©üÁâàÊäΩÂ±úÂàáÊèõÊåâÈàï -->
                <div class="filter-drawer-toggle" id="filterDrawerToggle">
                    <span class="material-symbols-outlined">tune</span>
                    <span>ÈÄ≤ÈöéÁØ©ÈÅ∏</span>
                    <span class="material-symbols-outlined filter-arrow">expand_more</span>
                </div>
                
                <!-- ÁØ©ÈÅ∏Âô®ÂÖßÂÆπÂçÄÂüü -->
                <div class="filter-content" id="filterContent">
                    <div class="filter-section">
                        <div class="filter-group">
                            <label class="filter-label">Âπ¥‰ªΩÔºö</label>
                            <div class="multiselect-container" id="yearFilterContainer">
                                <div class="multiselect-toggle" id="yearFilterToggle" disabled>
                                    <span>ÈÅ∏ÊìáÂπ¥‰ªΩ</span>
                                    <span class="multiselect-arrow material-symbols-outlined">expand_more</span>
                                </div>
                                <div class="multiselect-dropdown" id="yearFilterDropdown">
                                </div>
                            </div>
                        </div>
                        <div class="filter-group">
                            <label class="filter-label">È°åÂûãÔºö</label>
                            <div class="multiselect-container" id="partFilterContainer">
                                <div class="multiselect-toggle" id="partFilterToggle" disabled>
                                    <span>ÈÅ∏ÊìáÈ°åÂûã</span>
                                    <span class="multiselect-arrow material-symbols-outlined">expand_more</span>
                                </div>
                                <div class="multiselect-dropdown" id="partFilterDropdown">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="loading" id="loading">
                <div class="spinner"></div>
                <div>Ê≠£Âú®ËºâÂÖ•Ë≥áÊñô‰∏≠...</div>
            </div>

            <div id="resultsInfo" class="results-info" style="display: none;">
                <div class="results-header">
                    <span class="results-count" id="resultsCount"></span>
                    <div class="results-actions">
                        <div class="download-dropdown">
                            <button id="downloadButton" class="action-button download-button" title="‰∏ãËºâÁµêÊûú">
                                <span class="material-symbols-outlined">download</span>
                                ‰∏ãËºâ
                                <span class="material-symbols-outlined">expand_more</span>
                            </button>
                            <div class="download-menu" id="downloadMenu">
                                <button onclick="downloadData('markdown')" class="download-option">
                                    <span class="material-symbols-outlined">description</span>
                                    Markdown (.md)
                                </button>
                                <button onclick="downloadData('tsv')" class="download-option">
                                    <span class="material-symbols-outlined">table_view</span>
                                    TSV (.tsv)
                                </button>
                                <button onclick="downloadData('excel')" class="download-option">
                                    <span class="material-symbols-outlined">table_chart</span>
                                    Excel (.xlsx)
                                </button>
                                <button onclick="downloadData('word')" class="download-option">
                                    <span class="material-symbols-outlined">description</span>
                                    Word (.docx)
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="content">
             <div id="errorMessage" class="error-message" style="display: none;"></div>
            
            <div id="resultsContainer" class="results-container">
                <table id="resultsTable" class="results-table" style="display: none;">
                    <thead>
                        <tr>
                            <th>Âπ¥‰ªΩ</th>
                            <th>È°åÂûã</th>
                            <th>‰æÜÊ∫ê</th>
                            <th>‰æãÂè• (English)</th>
                            <th>‰æãÂè•ÁøªË≠Ø (‰∏≠Êñá)</th>
                        </tr>
                    </thead>
                    <tbody id="resultsBody">
                    </tbody>
                </table>
            </div>

            <div id="noResults" class="no-results" style="display: none;">
                Ê≤íÊúâÊâæÂà∞Á¨¶ÂêàÊ¢ù‰ª∂ÁöÑÁµêÊûú
            </div>
        </div>
    </div>

    <script>
        // Google Apps Script ÈÉ®ÁΩ≤ URLÔºàË´ãÂ°´ÂÖ•ÊÇ®ÁöÑÈÉ®ÁΩ≤ URLÔºâ
        const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbx1WGutPq5TBle1TXEdGSpD84u9w97C36pmH_G6HxofF9SAgMW72I24UFR2nNubK6v3Lw/exec'; // Ë´ãÂ∞áÊ≠§ÊõøÊèõÁÇ∫ÊÇ®ÁöÑ Google Apps Script ÈÉ®ÁΩ≤ URL
 
        // ÂÖ®ÂüüËÆäÊï∏
        let allData = [];
        let filteredData = [];
        let years = new Set();
        let parts = new Set();
        let wordSearchResults = []; // ÂÑ≤Â≠òÂñÆÂ≠óÊêúÂ∞ãÁöÑÁµêÊûú
        
        // Âø´ÂèñÁõ∏ÈóúÂ∏∏Êï∏
        const CACHE_KEY = 'vocabSentenceFinder_data';
        const CACHE_TIMESTAMP_KEY = 'vocabSentenceFinder_lastVisit';
        const CACHE_EXPIRY_HOURS = 24; // 24Â∞èÊôÇÂø´ÂèñÊúâÊïàÊúü
 
        // DOM ÂÖÉÁ¥†
        const wordSearchInput = document.getElementById('wordSearchInput');
        const searchModeIndicator = document.getElementById('searchModeIndicator');
        const yearFilterToggle = document.getElementById('yearFilterToggle');
        const yearFilterDropdown = document.getElementById('yearFilterDropdown');
        const partFilterToggle = document.getElementById('partFilterToggle');
        const partFilterDropdown = document.getElementById('partFilterDropdown');
        const statusText = document.getElementById('statusText');
        const loading = document.getElementById('loading');
        const errorMessage = document.getElementById('errorMessage');
        const resultsInfo = document.getElementById('resultsInfo');
        const resultsCount = document.getElementById('resultsCount');
        const resultsTable = document.getElementById('resultsTable');
        const resultsBody = document.getElementById('resultsBody');
        const noResults = document.getElementById('noResults');

        const downloadButton = document.getElementById('downloadButton');
        const downloadMenu = document.getElementById('downloadMenu');
        const filterSection = document.querySelector('.filter-section');
        const cacheStatus = document.getElementById('cacheStatus');
        const cacheIndicator = document.getElementById('cacheIndicator');
        const refreshButton = document.getElementById('refreshButton');
        
        // ÁØ©ÈÅ∏Âô®ÂÖÉÁ¥†
        const filterContainer = document.getElementById('filterContainer');
        const filterDrawerToggle = document.getElementById('filterDrawerToggle');
        const filterContent = document.getElementById('filterContent');
        
        // Á∑äÊπäÊ®°ÂºèÂÖÉÁ¥†
        const compactToggle = document.getElementById('compactToggle');

        // ÂÖ®ÂüüÁãÄÊÖã
        let isDataLoaded = false;
        let selectedYears = new Set();
        let selectedParts = new Set();
        let isUpdatingFilters = false; // Èò≤Ê≠¢ÁÑ°ÈôêÂæ™Áí∞ÁöÑÊ®ôË™å
 
        // ÂàùÂßãÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });
 
        function initializeApp() {
            // Ë®≠ÂÆö‰∫ã‰ª∂Áõ£ËÅΩÂô®
            wordSearchInput.addEventListener('input', debounce(handleWordSearch, 300));
            
            // Ë§áÈÅ∏ÁØ©ÈÅ∏Âô®‰∫ã‰ª∂
            yearFilterToggle.addEventListener('click', () => toggleMultiselect('year'));
            partFilterToggle.addEventListener('click', () => toggleMultiselect('part'));
            
            // ÁØ©ÈÅ∏Âô®ÊäΩÂ±ú‰∫ã‰ª∂
            filterDrawerToggle.addEventListener('click', () => toggleFilterDrawer());
            
            // ‰∏ãËºâÂäüËÉΩ
            downloadButton.addEventListener('click', () => toggleDownloadMenu());
            
            // Á∑äÊπäÊ®°ÂºèÂàáÊèõÂäüËÉΩ
            compactToggle.addEventListener('click', () => toggleCompactMode());
            
            // ÈáçÊñ∞ËºâÂÖ•ÂäüËÉΩ
            refreshButton.addEventListener('click', () => {
                refreshButton.disabled = true;
                loadData(true).finally(() => {
                    refreshButton.disabled = false;
                });
            });
            
            // ÈªûÊìäÂ§ñÈÉ®ÈóúÈñâ‰∏ãÊãâÈÅ∏ÂñÆ
            document.addEventListener('click', (e) => {
                // ÁØ©ÈÅ∏Âô®‰∏ãÊãâÈÅ∏ÂñÆ
                if (!yearFilterToggle.contains(e.target) && !yearFilterDropdown.contains(e.target)) {
                    yearFilterDropdown.style.display = 'none';
                    yearFilterToggle.setAttribute('aria-expanded', false);
                }
                if (!partFilterToggle.contains(e.target) && !partFilterDropdown.contains(e.target)) {
                    partFilterDropdown.style.display = 'none';
                    partFilterToggle.setAttribute('aria-expanded', false);
                }
                
                // ‰∏ãËºâÈÅ∏ÂñÆ
                if (!downloadButton.contains(e.target) && !downloadMenu.contains(e.target)) {
                    downloadMenu.style.display = 'none';
                }
            });

            // Áõ£ËÅΩÊªæÂãï‰∫ã‰ª∂‰æÜËôïÁêÜ sticky ÊéßÂà∂ÂçÄÂüüÁöÑË¶ñË¶∫ÊïàÊûú
            setupStickyControls();
            
            // ÂàùÂßãÂåñÁ∑äÊπäÊ®°ÂºèÂÅèÂ•ΩË®≠ÂÆö
            initializeCompactMode();
            
            // Áõ£ËÅΩË¶ñÁ™óÂ§ßÂ∞èËÆäÂåñÔºåÁ¢∫‰øùÁØ©ÈÅ∏Âô®È°ØÁ§∫Ê≠£Á¢∫
            window.addEventListener('resize', () => {
                if (filterContainer.style.display === 'block') {
                    if (window.innerWidth >= 600) {
                        // Ê°åÈù¢ÁâàÔºöÁ¢∫‰øùÂÖßÂÆπÈ°ØÁ§∫
                        filterContent.style.display = 'block';
                    } else {
                        // ÊâãÊ©üÁâàÔºöÊÅ¢Âæ©ÊäΩÂ±úÁãÄÊÖãÔºàÂ¶ÇÊûú‰πãÂâçÊòØÂ±ïÈñãÁöÑË©±‰øùÊåÅÂ±ïÈñãÔºâ
                        // CSS ÊúÉËá™ÂãïËôïÁêÜÈö±Ëóè
                    }
                }
            });
            
            // ËºâÂÖ•Ë≥áÊñô
            loadData();
        }

        function setupStickyControls() {
            const controls = document.querySelector('.controls');
            let isScrolled = false;

            window.addEventListener('scroll', () => {
                const currentScroll = window.pageYOffset;
                
                if (currentScroll > 100 && !isScrolled) {
                    controls.classList.add('scrolled');
                    isScrolled = true;
                } else if (currentScroll <= 100 && isScrolled) {
                    controls.classList.remove('scrolled');
                    isScrolled = false;
                }
            });
        }
 
        // Âø´ÂèñÁÆ°ÁêÜÂáΩÊï∏
        function isCacheValid() {
            const lastVisit = localStorage.getItem(CACHE_TIMESTAMP_KEY);
            if (!lastVisit) return false;
            
            const lastVisitTime = new Date(lastVisit);
            const now = new Date();
            const hoursDiff = (now - lastVisitTime) / (1000 * 60 * 60);
            
            return hoursDiff < CACHE_EXPIRY_HOURS;
        }

        function getCachedData() {
            try {
                const cachedData = localStorage.getItem(CACHE_KEY);
                return cachedData ? JSON.parse(cachedData) : null;
            } catch (error) {
                console.warn('ËÆÄÂèñÂø´ÂèñË≥áÊñôÂ§±Êïó:', error);
                return null;
            }
        }

        function setCachedData(data) {
            try {
                localStorage.setItem(CACHE_KEY, JSON.stringify(data));
                localStorage.setItem(CACHE_TIMESTAMP_KEY, new Date().toISOString());
                return true;
            } catch (error) {
                console.warn('ÂÑ≤Â≠òÂø´ÂèñË≥áÊñôÂ§±Êïó:', error);
                return false;
            }
        }

        function clearCache() {
            localStorage.removeItem(CACHE_KEY);
            localStorage.removeItem(CACHE_TIMESTAMP_KEY);
        }

        function showCacheStatus(isUsingCache, isOldCache = false) {
            if (isUsingCache) {
                cacheStatus.style.display = 'flex';
                const lastVisit = localStorage.getItem(CACHE_TIMESTAMP_KEY);
                const lastVisitTime = lastVisit ? new Date(lastVisit) : new Date();
                const timeAgo = formatTimeAgo(lastVisitTime);
                
                if (isOldCache) {
                    cacheIndicator.textContent = `‚ö†Ô∏è ‰ΩøÁî®ËàäÂø´ÂèñË≥áÊñô (${timeAgo})`;
                    cacheIndicator.className = 'cache-indicator old-cache';
                } else {
                    cacheIndicator.textContent = `üíæ ‰ΩøÁî®Âø´ÂèñË≥áÊñô (${timeAgo})`;
                    cacheIndicator.className = 'cache-indicator using-cache';
                }
            } else {
                cacheStatus.style.display = 'none';
            }
        }

        function formatTimeAgo(date) {
            const now = new Date();
            const diffMs = now - date;
            const diffHours = Math.floor(diffMs / (1000 * 60 * 60));
            const diffMinutes = Math.floor(diffMs / (1000 * 60));
            
            if (diffHours >= 24) {
                const diffDays = Math.floor(diffHours / 24);
                return `${diffDays} Â§©Ââç`;
            } else if (diffHours >= 1) {
                return `${diffHours} Â∞èÊôÇÂâç`;
            } else if (diffMinutes >= 1) {
                return `${diffMinutes} ÂàÜÈêòÂâç`;
            } else {
                return 'ÂâõÂâõ';
            }
        }
 
        async function loadData(forceRefresh = false) {
            try {
                showLoading(true);
                
                // Ê™¢Êü•ÊòØÂê¶ÂèØ‰ª•‰ΩøÁî®Âø´Âèñ
                if (!forceRefresh && isCacheValid()) {
                    const cachedData = getCachedData();
                    if (cachedData && cachedData.length > 0) {
                        updateStatus('Ê≠£Âú®ËºâÂÖ•Âø´ÂèñË≥áÊñô...');
                        allData = cachedData;
                        
                        updateStatus(`‰ΩøÁî®Âø´ÂèñË≥áÊñôËºâÂÖ• ${allData.length} Á≠ÜË≥áÊñôÔºÅÁ≥ªÁµ±Â∑≤Ê∫ñÂÇôÂ∞±Á∑í„ÄÇ`);
                        showLoading(false);
                        
                        // ÂïüÁî®ÊâÄÊúâÂäüËÉΩ
                        enableAllFeatures();
                        isDataLoaded = true;
                        
                        // È°ØÁ§∫Âø´ÂèñÁãÄÊÖã
                        showCacheStatus(true);
                        return;
                    }
                }
                
                // ËºâÂÖ•Êñ∞Ë≥áÊñô
                updateStatus('Ê≠£Âú®Âæû Google Sheets ËºâÂÖ•ÊúÄÊñ∞Ë≥áÊñô...');
                showCacheStatus(false);
 
                // ÂòóË©¶‰ΩøÁî® GET Ë´ãÊ±Ç
                let response;
                try {
                    response = await fetch(`${APPS_SCRIPT_URL}?action=getData`, {
                        method: 'GET',
                        headers: {
                            'Content-Type': 'application/json',
                        }
                    });
                } catch (fetchError) {
                    console.log('GET Ë´ãÊ±ÇÂ§±ÊïóÔºåÂòóË©¶ POST Ë´ãÊ±Ç...');
                    // Â¶ÇÊûú GET Â§±ÊïóÔºåÂòóË©¶ POST
                    response = await fetch(APPS_SCRIPT_URL, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/x-www-form-urlencoded',
                        },
                        body: 'action=getData'
                    });
                }
 
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status} - ${response.statusText}`);
                }
 
                const result = await response.json();
                console.log('API ÂõûÊáâ:', result);
                
                if (!result.success) {
                    throw new Error(result.error || result.message || 'ËºâÂÖ•Ë≥áÊñôÂ§±Êïó');
                }
 
                // ËôïÁêÜË≥áÊñô
                allData = processSheetData(result.data);
                
                // ÂÑ≤Â≠òÂà∞Âø´Âèñ
                setCachedData(allData);
                
                updateStatus(`ÊàêÂäüËºâÂÖ• ${allData.length} Á≠ÜÊúÄÊñ∞Ë≥áÊñôÔºÅÁ≥ªÁµ±Â∑≤Ê∫ñÂÇôÂ∞±Á∑í„ÄÇ`);
                showLoading(false);
                 
                // ÂïüÁî®ÊâÄÊúâÂäüËÉΩ
                enableAllFeatures();
                isDataLoaded = true;
 
            } catch (error) {
                console.error('ËºâÂÖ•Ë≥áÊñôÊôÇÁôºÁîüÈåØË™§:', error);
                
                // Â¶ÇÊûúÁ∂≤Ë∑ØËºâÂÖ•Â§±ÊïóÔºåÂòóË©¶‰ΩøÁî®ËàäÂø´Âèñ
                const cachedData = getCachedData();
                if (cachedData && cachedData.length > 0) {
                    console.log('‰ΩøÁî®ËàäÂø´ÂèñË≥áÊñô‰ΩúÁÇ∫ÂÇôÁî®');
                    allData = cachedData;
                    updateStatus(`Á∂≤Ë∑ØËºâÂÖ•Â§±ÊïóÔºå‰ΩøÁî®ËàäÂø´ÂèñË≥áÊñô (${allData.length} Á≠Ü)„ÄÇÁ≥ªÁµ±Â∑≤Ê∫ñÂÇôÂ∞±Á∑í„ÄÇ`);
                    showLoading(false);
                    enableAllFeatures();
                    isDataLoaded = true;
                    showCacheStatus(true, true);
                } else {
                showError('ËºâÂÖ•Ë≥áÊñôÊôÇÁôºÁîüÈåØË™§: ' + error.message);
                showLoading(false);
                }
            }
        }
 
        function processSheetData(sheetData) {
            return sheetData.map(row => {
                return {
                    year: String(row['Year_code'] || row['year'] || ''), // Á¢∫‰øùÂπ¥‰ªΩÊòØÂ≠ó‰∏≤
                    part: String(row['Part'] || row['part'] || ''), // Á¢∫‰øùÈ°åÂûãÊòØÂ≠ó‰∏≤
                    source: String(row['Source_code'] || row['source'] || ''),
                    sentence: String(row['Sentence'] || row['sentence'] || ''),
                    translation: String(row['Translation Traditional Chinese'] || row['translation'] || '')
                };
            }).filter(item => item.sentence && item.translation); // ÈÅéÊøæÁ©∫Ë≥áÊñô
        }
 
        // ÂïüÁî®ÊâÄÊúâÂäüËÉΩ
        function enableAllFeatures() {
            wordSearchInput.disabled = false;
        }

        // ÂàáÊèõÁØ©ÈÅ∏Âô®ÊäΩÂ±úÔºàÂè™Âú®ÊâãÊ©üÁâàÊúâÊïàÔºâ
        function toggleFilterDrawer() {
            // Âè™Âú®ÊâãÊ©üÁâàÔºàÂ∞èÊñº 600pxÔºâÊâçÂü∑Ë°åÊäΩÂ±úÂàáÊèõ
            if (window.innerWidth >= 600) {
                return; // Ê°åÈù¢Áâà‰∏çÂü∑Ë°åÊäΩÂ±úÂäüËÉΩ
            }
            
            const isOpen = filterContent.style.display === 'block';
            filterContent.style.display = isOpen ? 'none' : 'block';
            filterDrawerToggle.setAttribute('aria-expanded', !isOpen);
        }

        // ÂàáÊèõË§áÈÅ∏‰∏ãÊãâÈÅ∏ÂñÆ
        function toggleMultiselect(type) {
            if (!isDataLoaded) return;
            
            if (type === 'year') {
                const isVisible = yearFilterDropdown.style.display === 'block';
                yearFilterDropdown.style.display = isVisible ? 'none' : 'block';
                yearFilterToggle.setAttribute('aria-expanded', !isVisible);
                partFilterDropdown.style.display = 'none';
                partFilterToggle.setAttribute('aria-expanded', false);
            } else if (type === 'part') {
                const isVisible = partFilterDropdown.style.display === 'block';
                partFilterDropdown.style.display = isVisible ? 'none' : 'block';
                partFilterToggle.setAttribute('aria-expanded', !isVisible);
                yearFilterDropdown.style.display = 'none';
                yearFilterToggle.setAttribute('aria-expanded', false);
            }
        }

        // Êõ¥Êñ∞Ë§áÈÅ∏ÁãÄÊÖã
        function updateMultiselect(type) {
            if (type === 'year') {
                selectedYears.clear();
                const checkboxes = yearFilterDropdown.querySelectorAll('input[type="checkbox"]:checked');
                checkboxes.forEach(cb => selectedYears.add(cb.value));
                
                // Êõ¥Êñ∞Âπ¥‰ªΩÁØ©ÈÅ∏Âô®ÁöÑÈ°ØÁ§∫ÊñáÂ≠ó
                const totalYears = yearFilterDropdown.querySelectorAll('input[type="checkbox"]').length;
                updateFilterToggleText('year', totalYears);
                
                // Áï∂Âπ¥‰ªΩÁØ©ÈÅ∏Âô®ÊîπËÆäÊôÇÔºåÂãïÊÖãÊõ¥Êñ∞È°åÂûãÁØ©ÈÅ∏Âô®ÁöÑÂèØÁî®ÈÅ∏È†ÖÔºàÈÅøÂÖçÁÑ°ÈôêÂæ™Áí∞Ôºâ
                if (!isUpdatingFilters) {
                    updateDependentFilter('part');
                }
            } else if (type === 'part') {
                selectedParts.clear();
                const checkboxes = partFilterDropdown.querySelectorAll('input[type="checkbox"]:checked');
                checkboxes.forEach(cb => selectedParts.add(cb.value));
                
                // Êõ¥Êñ∞È°åÂûãÁØ©ÈÅ∏Âô®ÁöÑÈ°ØÁ§∫ÊñáÂ≠ó
                const totalParts = partFilterDropdown.querySelectorAll('input[type="checkbox"]').length;
                updateFilterToggleText('part', totalParts);
                
                // Áï∂È°åÂûãÁØ©ÈÅ∏Âô®ÊîπËÆäÊôÇÔºåÂãïÊÖãÊõ¥Êñ∞Âπ¥‰ªΩÁØ©ÈÅ∏Âô®ÁöÑÂèØÁî®ÈÅ∏È†ÖÔºàÈÅøÂÖçÁÑ°ÈôêÂæ™Áí∞Ôºâ
                if (!isUpdatingFilters) {
                    updateDependentFilter('year');
                }
            }
            
            // ÈáçÊñ∞Âü∑Ë°åÁØ©ÈÅ∏
            applyFilters();
        }
        


        // Êõ¥Êñ∞ÁØ©ÈÅ∏Âô®ÊåâÈàïÁöÑÈ°ØÁ§∫ÊñáÂ≠ó
        function updateFilterToggleText(type, total) {
            if (type === 'year') {
                const selectedCount = selectedYears.size;
                yearFilterToggle.querySelector('span').textContent = 
                    selectedCount === 0 ? 'ÈÅ∏ÊìáÂπ¥‰ªΩ' : 
                    selectedCount === total ? 'ÂÖ®ÈÉ®Âπ¥‰ªΩ' : 
                    `Â∑≤ÈÅ∏ ${selectedCount} ÂÄãÂπ¥‰ªΩ`;
            } else if (type === 'part') {
                const selectedCount = selectedParts.size;
                partFilterToggle.querySelector('span').textContent = 
                    selectedCount === 0 ? 'ÈÅ∏ÊìáÈ°åÂûã' : 
                    selectedCount === total ? 'ÂÖ®ÈÉ®È°åÂûã' : 
                    `Â∑≤ÈÅ∏ ${selectedCount} ÂÄãÈ°åÂûã`;
            }
        }
        
        // ÊáâÁî®ÁØ©ÈÅ∏Âô®
        function applyFilters() {
            if (wordSearchResults.length === 0) {
                filteredData = [];
                displayDataWithHighlight([], []);
                return;
            }
            
            filteredData = wordSearchResults.filter(item => {
                // Âπ¥‰ªΩÁØ©ÈÅ∏ÔºàË§áÈÅ∏Ôºâ- Á¢∫‰øùË≥áÊñôÈ°ûÂûã‰∏ÄËá¥
                const itemYear = String(item.year);
                const matchesYear = selectedYears.size === 0 || selectedYears.has(itemYear);

                // È°åÂûãÁØ©ÈÅ∏ÔºàË§áÈÅ∏Ôºâ- Á¢∫‰øùË≥áÊñôÈ°ûÂûã‰∏ÄËá¥
                const itemPart = String(item.part);
                const matchesPart = selectedParts.size === 0 || selectedParts.has(itemPart);

                return matchesYear && matchesPart;
            });

            // Â¶ÇÊûúÊúâÊêúÂ∞ãË©ûÔºåÂâáÈ´ò‰∫ÆÈ°ØÁ§∫
            const wordTerm = wordSearchInput.value.trim();
            if (wordTerm) {
                const variations = generateWordVariations(wordTerm);
                displayDataWithHighlight(filteredData, variations);
            } else {
                displayData(filteredData);
            }
        }

        // Ë®àÁÆóÂú®Áï∂ÂâçÁØ©ÈÅ∏Ê¢ù‰ª∂‰∏ãÂèØÁî®ÁöÑÈÅ∏È†Ö
        function getAvailableOptions(type, baseData = wordSearchResults) {
            if (baseData.length === 0) return [];
            
            let filteredData = baseData;
            
            // Ê†πÊìöÂè¶‰∏ÄÂÄãÁØ©ÈÅ∏Âô®ÁöÑÈÅ∏Êìá‰æÜÈÅéÊøæË≥áÊñô
            if (type === 'year') {
                // Ë®àÁÆóÂπ¥‰ªΩÈÅ∏È†ÖÊôÇÔºåËÄÉÊÖÆÂ∑≤ÈÅ∏ÊìáÁöÑÈ°åÂûã
                if (selectedParts.size > 0) {
                    filteredData = baseData.filter(item => {
                        const itemPart = String(item.part);
                        return selectedParts.has(itemPart);
                    });
                }
                return Array.from(new Set(filteredData.map(item => item.year))).sort();
            } else if (type === 'part') {
                // Ë®àÁÆóÈ°åÂûãÈÅ∏È†ÖÊôÇÔºåËÄÉÊÖÆÂ∑≤ÈÅ∏ÊìáÁöÑÂπ¥‰ªΩ
                if (selectedYears.size > 0) {
                    filteredData = baseData.filter(item => {
                        const itemYear = String(item.year);
                        return selectedYears.has(itemYear);
                    });
                }
                return Array.from(new Set(filteredData.map(item => item.part))).sort();
            }
            
            return [];
        }
        
        // Êõ¥Êñ∞‰æùË≥¥ÁöÑÁØ©ÈÅ∏Âô®ÔºàÈõôÂêëÂãïÊÖãÊõ¥Êñ∞ÁöÑÊ†∏ÂøÉÂäüËÉΩÔºâ
        function updateDependentFilter(type) {
            if (!isDataLoaded || wordSearchResults.length === 0) return;
            
            const availableOptions = getAvailableOptions(type);
            
            if (type === 'year') {
                updateFilterDropdown('year', availableOptions, selectedYears);
            } else if (type === 'part') {
                updateFilterDropdown('part', availableOptions, selectedParts);
            }
        }
        
        // Êõ¥Êñ∞ÁØ©ÈÅ∏Âô®‰∏ãÊãâÈÅ∏ÂñÆ
        function updateFilterDropdown(type, availableOptions, selectedSet) {
            let dropdown, toggleElement;
            
            if (type === 'year') {
                dropdown = yearFilterDropdown;
                toggleElement = yearFilterToggle;
            } else if (type === 'part') {
                dropdown = partFilterDropdown;
                toggleElement = partFilterToggle;
            } else {
                return;
            }
            
            // Ë®≠ÂÆöÊõ¥Êñ∞Ê®ôË™åÔºåÈò≤Ê≠¢ÁÑ°ÈôêÂæ™Áí∞
            isUpdatingFilters = true;
            
            try {
                // ÂÑ≤Â≠òÁï∂ÂâçÁöÑÈÅ∏ÊìáÁãÄÊÖã
                const currentSelections = new Set(selectedSet);
                
                // Ê∏ÖÁ©∫‰∏¶ÈáçÂª∫‰∏ãÊãâÈÅ∏ÂñÆ
                dropdown.innerHTML = '';
                
                availableOptions.forEach(option => {
                    const optionDiv = document.createElement('div');
                    optionDiv.className = 'multiselect-option';
                    
                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.value = option;
                    checkbox.checked = currentSelections.has(option);
                    
                    if (type === 'year') {
                        checkbox.id = `year-${option}`;
                        checkbox.addEventListener('change', () => updateMultiselect('year'));
                    } else if (type === 'part') {
                        const partId = option.replace(/\s+/g, '-');
                        checkbox.id = `part-${partId}`;
                        checkbox.addEventListener('change', () => updateMultiselect('part'));
                    }
                    
                    const label = document.createElement('label');
                    label.htmlFor = checkbox.id;
                    label.textContent = option;
                    
                    optionDiv.appendChild(checkbox);
                    optionDiv.appendChild(label);
                    dropdown.appendChild(optionDiv);
                });
                
                // Êõ¥Êñ∞ÊåâÈàïÈ°ØÁ§∫ÊñáÂ≠ó
                updateFilterToggleText(type, availableOptions.length);
                
                // Ê™¢Êü•ÊòØÂê¶ÊúâÈÅ∏È†ÖË¢´ÁßªÈô§ÔºàÂõ†ÁÇ∫ËàáÂÖ∂‰ªñÁØ©ÈÅ∏Âô®‰∏çÁõ∏ÂÆπÔºâ
                const removedSelections = [...currentSelections].filter(selection => 
                    !availableOptions.includes(selection)
                );
                
                if (removedSelections.length > 0) {
                    // ÁßªÈô§‰∏çÁõ∏ÂÆπÁöÑÈÅ∏È†Ö
                    removedSelections.forEach(selection => selectedSet.delete(selection));
                    console.log(`Â∑≤ÁßªÈô§‰∏çÁõ∏ÂÆπÁöÑ${type === 'year' ? 'Âπ¥‰ªΩ' : 'È°åÂûã'}ÈÅ∏È†Ö: ${removedSelections.join(', ')}`);
                }
            } finally {
                // Á¢∫‰øùÊ®ôË™åË¢´ÈáçÁΩÆ
                isUpdatingFilters = false;
            }
        }

        function updateFilters(data) {
            if (data.length === 0) {
                filterContainer.style.display = 'none';
                yearFilterToggle.setAttribute('disabled', true);
                partFilterToggle.setAttribute('disabled', true);
                return;
            }

            filterContainer.style.display = 'block';
            yearFilterToggle.removeAttribute('disabled');
            partFilterToggle.removeAttribute('disabled');
            
            // Á¢∫‰øùÊ°åÈù¢ÁâàÁöÑÁØ©ÈÅ∏Âô®ÂÖßÂÆπÈ°ØÁ§∫Ê≠£Á¢∫
            if (window.innerWidth >= 600) {
                filterContent.style.display = 'block';
            }

            // ÂàùÂßãÂåñÊôÇÔºåÊâÄÊúâÈÅ∏È†ÖÈÉΩÂèØÁî®
            const availableYears = getAvailableOptions('year', data);
            const availableParts = getAvailableOptions('part', data);

            // Êõ¥Êñ∞ÂÖ©ÂÄãÁØ©ÈÅ∏Âô®
            updateFilterDropdown('year', availableYears, selectedYears);
            updateFilterDropdown('part', availableParts, selectedParts);
        }
 
        // Ë©ûÂΩ¢ËÆäÂåñË¶èÂâáÂíåË©ûÂππÊèêÂèñÂäüËÉΩ
        const morphologyRules = {
            // Ë§áÊï∏Ë¶èÂâá
            plurals: [
                { pattern: /ies$/, replacement: 'y' },        // cities -> city
                { pattern: /ves$/, replacement: 'f' },        // lives -> life
                { pattern: /ves$/, replacement: 'fe' },       // knives -> knife
                { pattern: /ses$/, replacement: 's' },        // glasses -> glass
                { pattern: /ches$/, replacement: 'ch' },      // watches -> watch
                { pattern: /shes$/, replacement: 'sh' },      // dishes -> dish
                { pattern: /xes$/, replacement: 'x' },        // boxes -> box
                { pattern: /oes$/, replacement: 'o' },        // heroes -> hero
                { pattern: /s$/, replacement: '' },           // cats -> cat
            ],
            // ÂãïË©ûËÆäÂåñË¶èÂâá
            verbs: [
                // ÈÅéÂéªÂºèÂíåÈÅéÂéªÂàÜË©û
                { pattern: /ied$/, replacement: 'y' },        // studied -> study
                { pattern: /ed$/, replacement: '' },          // walked -> walk
                { pattern: /ed$/, replacement: 'e' },         // liked -> like
                { pattern: /(.)ed$/, replacement: '$1' },     // stopped -> stop
                
                // ÁèæÂú®ÂàÜË©û
                { pattern: /ying$/, replacement: 'y' },       // studying -> study
                { pattern: /ing$/, replacement: '' },         // walking -> walk
                { pattern: /ing$/, replacement: 'e' },        // liking -> like
                { pattern: /(.)ing$/, replacement: '$1' },    // stopping -> stop
                
                // Á¨¨‰∏â‰∫∫Á®±ÂñÆÊï∏
                { pattern: /ies$/, replacement: 'y' },        // flies -> fly
                { pattern: /es$/, replacement: '' },          // goes -> go
                { pattern: /s$/, replacement: '' },           // walks -> walk
            ],
            // ÂΩ¢ÂÆπË©ûÊØîËºÉÁ¥öÂíåÊúÄÈ´òÁ¥ö
            adjectives: [
                { pattern: /iest$/, replacement: 'y' },       // happiest -> happy
                { pattern: /est$/, replacement: '' },         // tallest -> tall
                { pattern: /(.)est$/, replacement: '$1' },    // biggest -> big
                { pattern: /ier$/, replacement: 'y' },        // happier -> happy
                { pattern: /er$/, replacement: '' },          // taller -> tall
                { pattern: /(.)er$/, replacement: '$1' },     // bigger -> big
            ],
            // ÂâØË©û
            adverbs: [
                { pattern: /ly$/, replacement: '' },          // quickly -> quick
                { pattern: /ily$/, replacement: 'y' },        // happily -> happy
            ]
        };

        // ‰∏çË¶èÂâáÂãïË©ûË°®
        const irregularVerbs = {
            'was': ['be', 'is', 'am', 'are', 'been', 'being'],
            'were': ['be', 'is', 'am', 'are', 'been', 'being'],
            'been': ['be', 'is', 'am', 'are', 'was', 'were', 'being'],
            'being': ['be', 'is', 'am', 'are', 'was', 'were', 'been'],
            'went': ['go', 'goes', 'going', 'gone'],
            'gone': ['go', 'goes', 'going', 'went'],
            'did': ['do', 'does', 'doing', 'done'],
            'done': ['do', 'does', 'doing', 'did'],
            'had': ['have', 'has', 'having'],
            'took': ['take', 'takes', 'taking', 'taken'],
            'taken': ['take', 'takes', 'taking', 'took'],
            'gave': ['give', 'gives', 'giving', 'given'],
            'given': ['give', 'gives', 'giving', 'gave'],
            'came': ['come', 'comes', 'coming'],
            'saw': ['see', 'sees', 'seeing', 'seen'],
            'seen': ['see', 'sees', 'seeing', 'saw'],
            'got': ['get', 'gets', 'getting', 'gotten'],
            'gotten': ['get', 'gets', 'getting', 'got'],
            'made': ['make', 'makes', 'making'],
            'said': ['say', 'says', 'saying'],
            'thought': ['think', 'thinks', 'thinking'],
            'found': ['find', 'finds', 'finding'],
            'knew': ['know', 'knows', 'knowing', 'known'],
            'known': ['know', 'knows', 'knowing', 'knew'],
            'left': ['leave', 'leaves', 'leaving'],
            'felt': ['feel', 'feels', 'feeling'],
            'kept': ['keep', 'keeps', 'keeping'],
            'told': ['tell', 'tells', 'telling'],
            'heard': ['hear', 'hears', 'hearing'],
            'brought': ['bring', 'brings', 'bringing'],
            'bought': ['buy', 'buys', 'buying'],
            'taught': ['teach', 'teaches', 'teaching'],
            'caught': ['catch', 'catches', 'catching'],
            'fought': ['fight', 'fights', 'fighting'],
            'wrote': ['write', 'writes', 'writing', 'written'],
            'written': ['write', 'writes', 'writing', 'wrote'],
            'rode': ['ride', 'rides', 'riding', 'ridden'],
            'ridden': ['ride', 'rides', 'riding', 'rode'],
            'drove': ['drive', 'drives', 'driving', 'driven'],
            'driven': ['drive', 'drives', 'driving', 'drove'],
            'spoke': ['speak', 'speaks', 'speaking', 'spoken'],
            'spoken': ['speak', 'speaks', 'speaking', 'spoke'],
            'chose': ['choose', 'chooses', 'choosing', 'chosen'],
            'chosen': ['choose', 'chooses', 'choosing', 'chose'],
            'broke': ['break', 'breaks', 'breaking', 'broken'],
            'broken': ['break', 'breaks', 'breaking', 'broke'],
            'wore': ['wear', 'wears', 'wearing', 'worn'],
            'worn': ['wear', 'wears', 'wearing', 'wore'],
            'threw': ['throw', 'throws', 'throwing', 'thrown'],
            'thrown': ['throw', 'throws', 'throwing', 'threw']
        };

        // Ê™¢Êü•Ë¶èÂâáÊòØÂê¶ÊúÉÁ∏ÆÁü≠ÂñÆÂ≠ó
        function isShortening(rule, originalWord) {
            // Ë®àÁÆóÂ•óÁî®Ë¶èÂâáÂæåÁöÑÈï∑Â∫¶ËÆäÂåñ
            const match = originalWord.match(rule.pattern);
            if (!match) return false;
            
            const originalLength = match[0].length;
            const replacementLength = rule.replacement.length;
            return replacementLength < originalLength;
        }

        // Âü∫Êú¨Ëã±ÊñáË©ûÂÖ∏ÔºàÂ∏∏Áî®ÂñÆÂ≠óÔºâ
        const basicDictionary = new Set([
            // Â∏∏Ë¶ãÁü≠ÂñÆÂ≠ó
            'a', 'an', 'as', 'at', 'be', 'by', 'do', 'go', 'he', 'i', 'if', 'in', 'is', 'it', 'me', 'my', 'no', 'of', 'on', 'or', 'so', 'to', 'up', 'we',
            // Â∏∏Ë¶ãÂãïË©û
            'am', 'are', 'was', 'were', 'been', 'being', 'have', 'has', 'had', 'do', 'does', 'did', 'will', 'would', 'can', 'could', 'may', 'might', 'must', 'shall', 'should',
            'get', 'got', 'give', 'gave', 'given', 'go', 'goes', 'went', 'gone', 'come', 'came', 'take', 'took', 'taken', 'see', 'saw', 'seen', 'know', 'knew', 'known',
            'think', 'thought', 'say', 'said', 'tell', 'told', 'make', 'made', 'find', 'found', 'want', 'like', 'look', 'use', 'work', 'try', 'ask', 'need', 'feel', 'felt',
            'seem', 'leave', 'left', 'put', 'mean', 'meant', 'keep', 'kept', 'let', 'begin', 'began', 'begun', 'help', 'show', 'showed', 'shown', 'hear', 'heard',
            'play', 'run', 'ran', 'move', 'live', 'believe', 'bring', 'brought', 'happen', 'write', 'wrote', 'written', 'sit', 'sat', 'stand', 'stood', 'lose', 'lost',
            'pay', 'paid', 'meet', 'met', 'include', 'continue', 'set', 'learn', 'learned', 'learnt', 'change', 'lead', 'led', 'understand', 'understood', 'watch', 'follow',
            'stop', 'stopped', 'create', 'speak', 'spoke', 'spoken', 'read', 'allow', 'add', 'spend', 'spent', 'grow', 'grew', 'grown', 'open', 'walk', 'win', 'won',
            'offer', 'remember', 'love', 'consider', 'appear', 'buy', 'bought', 'wait', 'serve', 'die', 'died', 'send', 'sent', 'expect', 'build', 'built', 'stay',
            'fall', 'fell', 'fallen', 'cut', 'reach', 'kill', 'remain', 'suggest', 'raise', 'pass', 'sell', 'sold', 'require', 'report', 'decide', 'pull',
            // Â∏∏Ë¶ãÂêçË©û
            'time', 'person', 'year', 'way', 'day', 'thing', 'man', 'world', 'life', 'hand', 'part', 'child', 'eye', 'woman', 'place', 'work', 'week', 'case', 'point',
            'government', 'company', 'number', 'group', 'problem', 'fact', 'water', 'money', 'story', 'month', 'book', 'home', 'school', 'house', 'car', 'job', 'word',
            'business', 'issue', 'side', 'kind', 'head', 'house', 'service', 'friend', 'father', 'power', 'hour', 'game', 'line', 'end', 'member', 'law', 'country',
            'family', 'student', 'idea', 'body', 'information', 'back', 'parent', 'face', 'others', 'level', 'office', 'door', 'health', 'person', 'art', 'war',
            'history', 'party', 'result', 'change', 'morning', 'reason', 'research', 'girl', 'guy', 'moment', 'air', 'teacher', 'force', 'education',
            // Â∏∏Ë¶ãÂΩ¢ÂÆπË©û
            'good', 'better', 'best', 'new', 'first', 'last', 'long', 'great', 'little', 'own', 'other', 'old', 'right', 'big', 'high', 'different', 'small',
            'large', 'next', 'early', 'young', 'important', 'few', 'public', 'bad', 'worse', 'worst', 'same', 'able', 'white', 'black', 'red', 'blue', 'green',
            'easy', 'hard', 'free', 'full', 'true', 'false', 'happy', 'sad', 'nice', 'beautiful', 'strong', 'weak', 'hot', 'cold', 'warm', 'cool', 'fast', 'slow'
        ]);

        // Ê™¢Êü•ÊòØÂê¶ÁÇ∫ÊúâÊïàËã±ÊñáÂñÆÂ≠ó
        function isValidWord(word) {
            const lowerWord = word.toLowerCase();
            // Âü∫Êú¨Ë©ûÂÖ∏Ê™¢Êü•
            if (basicDictionary.has(lowerWord)) return true;
            
            // Èï∑Â∫¶Ê™¢Êü•ÔºöÈÅéÁü≠ÊàñÈÅéÈï∑ÁöÑÂèØËÉΩ‰∏çÊòØÊúâÊïàÂñÆÂ≠ó
            if (lowerWord.length < 1 || lowerWord.length > 20) return false;
            
            // Âü∫Êú¨Â≠óÊØçÊ™¢Êü•
            if (!/^[a-z]+$/.test(lowerWord)) return false;
            
            // ‰ΩøÁî® compromise.js ÈÄ≤Ë°åË©ûÊÄßÊ™¢Ê∏¨
            try {
                const doc = nlp(lowerWord);
                const tags = doc.out('tags');
                // Â¶ÇÊûúÊúâË©ûÊÄßÊ®ôÁ±§ÔºåË™çÁÇ∫ÊòØÊúâÊïàÂñÆÂ≠ó
                return tags && tags.length > 0 && tags[0] && Object.keys(tags[0]).length > 0;
            } catch (e) {
                // Â¶ÇÊûú compromise.js Âá∫ÈåØÔºå‰ΩøÁî®Âü∫Êú¨È©óË≠â
                return lowerWord.length >= 2;
            }
        }

        // Ê™¢Ê∏¨ÂñÆÂ≠óË©ûÊÄß
        function getPartOfSpeech(word) {
            try {
                const doc = nlp(word);
                const terms = doc.terms().out('array');
                if (terms.length === 0) return 'unknown';
                
                const term = doc.terms().get(0);
                if (term.has('#Verb')) return 'verb';
                if (term.has('#Noun')) return 'noun';
                if (term.has('#Adjective')) return 'adjective';
                if (term.has('#Adverb')) return 'adverb';
                if (term.has('#Preposition')) return 'preposition';
                if (term.has('#Pronoun')) return 'pronoun';
                if (term.has('#Determiner')) return 'determiner';
                
                return 'unknown';
            } catch (e) {
                return 'unknown';
            }
        }

        // ÁîüÊàêÂñÆÂ≠óÁöÑÊâÄÊúâÂèØËÉΩËÆäÂåñÂΩ¢ÂºèÔºàÊô∫ËÉΩÊîπÂñÑÁâàÔºâ
        function generateWordVariations(word) {
            const variations = new Set([word.toLowerCase()]);
            const lowerWord = word.toLowerCase();
            
            // üîç Á¨¨‰∏ÄÂ±§È©óË≠âÔºöÊ™¢Êü•ÊòØÂê¶ÁÇ∫ÊúâÊïàËã±ÊñáÂñÆÂ≠ó
            if (!isValidWord(lowerWord)) {
                console.log(`‚ö†Ô∏è  "${word}" ÂèØËÉΩ‰∏çÊòØÊúâÊïàÁöÑËã±ÊñáÂñÆÂ≠óÔºåÂÉÖËøîÂõûÂéüÂßãÂΩ¢Âºè`);
                return [lowerWord];
            }

            // üéØ Á¨¨‰∫åÂ±§ÊîπÂñÑÔºöË©ûÊÄßÊ™¢Ê∏¨
            const partOfSpeech = getPartOfSpeech(lowerWord);
            const isShortWord = lowerWord.length < 3;
            
            console.log(`üîç ÂàÜÊûêÂñÆÂ≠ó "${word}": Ë©ûÊÄß=${partOfSpeech}, Èï∑Â∫¶=${lowerWord.length}, Áü≠ÂñÆÂ≠ó=${isShortWord}`);
            
            // Ê™¢Êü•‰∏çË¶èÂâáÂãïË©û
            if (irregularVerbs[lowerWord]) {
                irregularVerbs[lowerWord].forEach(variant => variations.add(variant));
            }
            
            // ÂèçÂêëÊü•Êâæ‰∏çË¶èÂâáÂãïË©û
            for (const [irregularForm, baseVariants] of Object.entries(irregularVerbs)) {
                if (baseVariants.includes(lowerWord)) {
                    variations.add(irregularForm);
                    baseVariants.forEach(variant => variations.add(variant));
                }
            }

            // ÊáâÁî®ÂΩ¢ÊÖãÂ≠∏Ë¶èÂâáÔºàÊô∫ËÉΩÂåñËôïÁêÜÔºâ
            Object.values(morphologyRules).forEach(ruleSet => {
                ruleSet.forEach(rule => {
                    if (rule.pattern.test(lowerWord)) {
                        // üö´ Áü≠ÂñÆÂ≠óË∑≥ÈÅéÁ∏ÆÁü≠Ë¶èÂâá
                        if (isShortWord && isShortening(rule, lowerWord)) {
                            return; // Ë∑≥ÈÅéÈÄôÂÄãË¶èÂâá
                        }
                        
                        const stem = lowerWord.replace(rule.pattern, rule.replacement);
                        variations.add(stem);
                        
                        // ÂæûË©ûÂππÁîüÊàêÂÖ∂‰ªñÂΩ¢Âºè
                        generateFormsFromStem(stem, isShortWord, partOfSpeech).forEach(form => variations.add(form));
                    }
                });
            });

            // ÂæûÂéüÂßãÂñÆÂ≠óÁîüÊàêÂÖ∂‰ªñÂΩ¢Âºè
            generateFormsFromStem(lowerWord, isShortWord, partOfSpeech).forEach(form => variations.add(form));

            // üóÇÔ∏è Á¨¨‰∏âÂ±§È©óË≠âÔºöÈÅéÊøæÁÑ°ÊïàÁöÑËÆäÂåñÂΩ¢Âºè
            const validVariations = Array.from(variations).filter(variant => {
                // ‰øùÁïôÂéüÂßãÂñÆÂ≠ó
                if (variant === lowerWord) return true;
                // Ê™¢Êü•‰∏çË¶èÂâáÂãïË©û
                if (Object.keys(irregularVerbs).includes(variant)) return true;
                if (Object.values(irregularVerbs).some(variants => variants.includes(variant))) return true;
                // Ê™¢Êü•ÂÖ∂‰ªñËÆäÂåñÊòØÂê¶ÁÇ∫ÊúâÊïàÂñÆÂ≠ó
                return isValidWord(variant);
            });

            console.log(`‚úÖ "${word}" ÁîüÊàê ${validVariations.length} ÂÄãÊúâÊïàËÆäÂåñ:`, validVariations);
            return validVariations;
        }

        // ÂæûË©ûÂππÁîüÊàêÂêÑÁ®ÆËÆäÂåñÂΩ¢ÂºèÔºàÊô∫ËÉΩÊîπÂñÑÁâàÔºåÂü∫ÊñºË©ûÊÄßÁöÑÁ≤æÁ¢∫ÁîüÊàêÔºâ
        function generateFormsFromStem(stem, isShortWord = false, partOfSpeech = 'unknown') {
            const forms = new Set([stem]);
            
            // üéØ Âü∫ÊñºË©ûÊÄßÁöÑÊô∫ËÉΩËÆäÂåñÁîüÊàê
            switch (partOfSpeech) {
                case 'noun':
                    // ÂêçË©ûÔºö‰∏ªË¶ÅÁîüÊàêË§áÊï∏ÂΩ¢Âºè
                    forms.add(stem + 's');
                    forms.add(stem + 'es');
                    if (stem.endsWith('y') && !isShortWord) {
                        forms.add(stem.slice(0, -1) + 'ies');
                    }
                    if (stem.endsWith('f') && !isShortWord) {
                        forms.add(stem.slice(0, -1) + 'ves');
                    }
                    if (stem.endsWith('fe') && !isShortWord) {
                        forms.add(stem.slice(0, -2) + 'ves');
                    }
                    break;
                    
                case 'verb':
                    // ÂãïË©ûÔºöÁîüÊàêÊôÇÊÖãËÆäÂåñ
                    forms.add(stem + 'ed');
                    forms.add(stem + 'ing');
                    forms.add(stem + 's'); // Á¨¨‰∏â‰∫∫Á®±ÂñÆÊï∏
                    
                    if (stem.endsWith('e')) {
                        forms.add(stem + 'd');
                        if (!isShortWord) {
                            forms.add(stem.slice(0, -1) + 'ing');
                        }
                    }
                    if (stem.endsWith('y') && !isShortWord) {
                        forms.add(stem.slice(0, -1) + 'ied');
                        forms.add(stem.slice(0, -1) + 'ying');
                    }
                    
                    // ÈõôÂØ´ËºîÈü≥Â≠óÊØçÁöÑË¶èÂâá
                    if (stem.length >= 3 && /[bcdfghjklmnpqrstvwxyz]$/.test(stem) && 
                        /[aeiou][bcdfghjklmnpqrstvwxyz]$/.test(stem)) {
                        const doubled = stem + stem.slice(-1);
                        forms.add(doubled + 'ed');
                        forms.add(doubled + 'ing');
                    }
                    break;
                    
                case 'adjective':
                    // ÂΩ¢ÂÆπË©ûÔºöÁîüÊàêÊØîËºÉÁ¥öÂíåÊúÄÈ´òÁ¥ö
                    forms.add(stem + 'er');
                    forms.add(stem + 'est');
                    forms.add(stem + 'ly'); // ÂâØË©ûÂΩ¢Âºè
                    
                    if (stem.endsWith('y') && !isShortWord) {
                        forms.add(stem.slice(0, -1) + 'ier');
                        forms.add(stem.slice(0, -1) + 'iest');
                        forms.add(stem.slice(0, -1) + 'ily');
                    }
                    break;
                    
                case 'adverb':
                    // ÂâØË©ûÔºöÈÄöÂ∏∏ËÆäÂåñËºÉÂ∞ë
                    if (stem.endsWith('ly')) {
                        // Â¶ÇÊûúÂ∑≤Á∂ìÊòØÂâØË©ûÂΩ¢ÂºèÔºåÂòóË©¶ÈÇÑÂéüÂΩ¢ÂÆπË©û
                        const adjBase = stem.slice(0, -2);
                        if (adjBase.length > 2) {
                            forms.add(adjBase);
                        }
                    }
                    break;
                    
                default:
                    // Êú™Áü•Ë©ûÊÄßÔºöÁîüÊàêÊâÄÊúâÂèØËÉΩÁöÑËÆäÂåñÔºå‰ΩÜÊõ¥‰øùÂÆà
                    if (!isShortWord) {
                        // Âè™Â∞çÈùûÁü≠ÂñÆÂ≠óÈÄ≤Ë°åÂÖ®Èù¢ËÆäÂåñ
                        forms.add(stem + 's');
                        forms.add(stem + 'ed');
                        forms.add(stem + 'ing');
                        forms.add(stem + 'er');
                        forms.add(stem + 'est');
                        forms.add(stem + 'ly');
                        
                        if (stem.endsWith('y')) {
                            forms.add(stem.slice(0, -1) + 'ies');
                            forms.add(stem.slice(0, -1) + 'ied');
                        }
                    } else {
                        // Áü≠ÂñÆÂ≠óÂè™Ê∑ªÂä†Âü∫Êú¨Êì¥Â±ï
                        forms.add(stem + 's');
                        forms.add(stem + 'ed');
                        forms.add(stem + 'ing');
                    }
            }

            return Array.from(forms);
        }



        // ÈáçÁΩÆÁØ©ÈÅ∏Âô®ÁãÄÊÖã
        function resetFilters() {
            selectedYears.clear();
            selectedParts.clear();
        }

        // ËôïÁêÜÂñÆÂ≠óÊêúÂ∞ã
        function handleWordSearch() {
            if (!isDataLoaded) return;
            
            const wordTerm = wordSearchInput.value.trim();
            
            if (!wordTerm) {
                searchModeIndicator.style.display = 'none';
                resultsTable.style.display = 'none';
                resultsInfo.style.display = 'none';
                noResults.style.display = 'none';
                filterContainer.style.display = 'none';
                wordSearchResults = [];
                filteredData = [];
                resetFilters(); // Ê∏ÖÁ©∫ÊêúÂ∞ãÊôÇ‰πüÈáçÁΩÆÁØ©ÈÅ∏Âô®
                return;
            }
 
            // ÊØèÊ¨°ÈÄ≤Ë°åÊñ∞ÊêúÂ∞ãÊôÇÈáçÁΩÆÁØ©ÈÅ∏Âô®ÁãÄÊÖã
            resetFilters();
            
            const variations = generateWordVariations(wordTerm);
            searchModeIndicator.style.display = 'block';
            searchModeIndicator.textContent = `Ê≠£Âú® VocabGem ‰∏≠ÊêúÂ∞ã„Äå${wordTerm}„Äçüíé Ê∂µËìã ${variations.length} Á®ÆË©ûÂΩ¢ËÆäÂåñÔºåÁÇ∫ÊÇ®ÊåñÊéòÁèçË≤¥ÁöÑÂ≠∏ÁøíÂØ∂Áü≥`;

            wordSearchResults = allData.filter(item => {
                const sentence = item.sentence.toLowerCase();
                return variations.some(variation => {
                    const regex = new RegExp(`\\b${escapeRegExp(variation)}\\b`, 'i');
                    return regex.test(sentence);
                });
            });

            updateFilters(wordSearchResults);
 
            // ÊáâÁî®ÁØ©ÈÅ∏Âô®
            applyFilters();
        }

        // ËΩâÁæ©Ê≠£ÂâáË°®ÈÅîÂºèÁâπÊÆäÂ≠óÁ¨¶
        function escapeRegExp(string) {
            return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
        }

        // Ë§áË£ΩÂñÆÂÄãÂè•Â≠êÂäüËÉΩ
        async function copySentence(sentence, button) {
            try {
                await navigator.clipboard.writeText(sentence);
                
                // Êõ¥Êñ∞ÊåâÈàïÁãÄÊÖã
                const originalIcon = button.innerHTML;
                button.innerHTML = '<span class="material-symbols-outlined">check</span>';
                button.classList.add('copied');
                
                // 2ÁßíÂæåÊÅ¢Âæ©ÂéüÁãÄ
                setTimeout(() => {
                    button.innerHTML = originalIcon;
                    button.classList.remove('copied');
                }, 2000);
                
            } catch (err) {
                console.error('Ë§áË£ΩÂ§±Êïó:', err);
                
                // Â¶ÇÊûúË§áË£ΩÂ§±ÊïóÔºåÈ°ØÁ§∫ÈåØË™§ÁãÄÊÖã
                const originalIcon = button.innerHTML;
                button.innerHTML = '<span class="material-symbols-outlined">error</span>';
                button.style.color = 'var(--md-sys-color-error)';
                
                setTimeout(() => {
                    button.innerHTML = originalIcon;
                    button.style.color = '';
                }, 2000);
            }
        }



        // ÂàáÊèõ‰∏ãËºâÈÅ∏ÂñÆ
        function toggleDownloadMenu() {
            const isVisible = downloadMenu.style.display === 'block';
            downloadMenu.style.display = isVisible ? 'none' : 'block';
        }

        // Á∑äÊπäÊ®°ÂºèÂàáÊèõÂäüËÉΩ
        function toggleCompactMode() {
            const body = document.body;
            const compactIcon = compactToggle.querySelector('.material-symbols-outlined');
            const isCompact = body.classList.contains('compact-mode');
            
            if (isCompact) {
                // ÈóúÈñâÁ∑äÊπäÊ®°Âºè
                body.classList.remove('compact-mode');
                compactIcon.textContent = 'compress';
                compactToggle.title = 'ÂàáÊèõÁ∑äÊπäÊ™¢Ë¶ñÊ®°Âºè';
                
                // Ë®ò‰Ωè‰ΩøÁî®ËÄÖÂÅèÂ•Ω
                localStorage.setItem('VocabGem_compactMode', 'false');
            } else {
                // ÈñãÂïüÁ∑äÊπäÊ®°Âºè
                body.classList.add('compact-mode');
                compactIcon.textContent = 'expand';
                compactToggle.title = 'ÂàáÊèõÊ≠£Â∏∏Ê™¢Ë¶ñÊ®°Âºè';
                
                // Ë®ò‰Ωè‰ΩøÁî®ËÄÖÂÅèÂ•Ω
                localStorage.setItem('VocabGem_compactMode', 'true');
            }
        }

        // ÂàùÂßãÂåñÁ∑äÊπäÊ®°ÂºèÂÅèÂ•ΩË®≠ÂÆö
        function initializeCompactMode() {
            const savedCompactMode = localStorage.getItem('VocabGem_compactMode');
            if (savedCompactMode === 'true') {
                document.body.classList.add('compact-mode');
                const compactIcon = compactToggle.querySelector('.material-symbols-outlined');
                compactIcon.textContent = 'expand';
                compactToggle.title = 'ÂàáÊèõÊ≠£Â∏∏Ê™¢Ë¶ñÊ®°Âºè';
            }
        }

        // ‰∏ãËºâÂäüËÉΩ
        function downloadData(format) {
            if (!filteredData || filteredData.length === 0) {
                alert('Ê≤íÊúâÂèØ‰∏ãËºâÁöÑÁµêÊûú');
                return;
            }

            downloadMenu.style.display = 'none';

            const headers = ['Âπ¥‰ªΩ', 'È°åÂûã', '‰æÜÊ∫ê', '‰æãÂè• (English)', '‰æãÂè•ÁøªË≠Ø (‰∏≠Êñá)'];
            const timestamp = new Date().toISOString().slice(0, 19).replace(/[:-]/g, '');
            
            if (format === 'markdown') {
                downloadMarkdown(headers, filteredData, timestamp);
            } else if (format === 'tsv') {
                downloadTSV(headers, filteredData, timestamp);
            } else if (format === 'excel') {
                downloadExcel(headers, filteredData, timestamp);
            } else if (format === 'word') {
                downloadWord(headers, filteredData, timestamp);
            }
        }

        // ‰∏ãËºâ Markdown Ê†ºÂºè
        function downloadMarkdown(headers, data, timestamp) {
            const separator = '|' + headers.map(() => '---').join('|') + '|';
            const headerRow = '|' + headers.join('|') + '|';
            const dataRows = data.map(item => 
                `|${item.year}|${item.part}|${item.source}|${item.sentence}|${item.translation}|`
            );

            const content = [headerRow, separator, ...dataRows].join('\n');
            downloadFile(content, `vocabulary_results_${timestamp}.md`, 'text/markdown');
        }

        // ‰∏ãËºâ TSV Ê†ºÂºè
        function downloadTSV(headers, data, timestamp) {
            const rows = data.map(item => [
                item.year,
                item.part,
                item.source,
                item.sentence,
                item.translation
            ]);

            const content = [headers, ...rows]
                .map(row => row.map(cell => `"${String(cell || '').replace(/"/g, '""')}"`).join('\t'))
                .join('\n');

            downloadFile(content, `vocabulary_results_${timestamp}.tsv`, 'text/tab-separated-values');
        }

        // ‰∏ãËºâ Excel Ê†ºÂºè (.xlsx)
        function downloadExcel(headers, data, timestamp) {
            try {
                // Ê∫ñÂÇôË≥áÊñôÈô£ÂàóÔºåÁ¨¨‰∏ÄË°åÊòØÊ®ôÈ°å
                const worksheetData = [headers];
                
                // Âä†ÂÖ•Ë≥áÊñôË°å
                data.forEach(item => {
                    worksheetData.push([
                        String(item.year || ''),
                        String(item.part || ''),
                        String(item.source || ''),
                        String(item.sentence || ''),
                        String(item.translation || '')
                    ]);
                });

                // Âª∫Á´ãÂ∑•‰ΩúË°®
                const worksheet = XLSX.utils.aoa_to_sheet(worksheetData);

                // Ë®≠ÂÆöÊ¨ÑÂØ¨
                const columnWidths = [
                    { wch: 8 },   // Âπ¥‰ªΩ
                    { wch: 15 },  // È°åÂûã
                    { wch: 12 },  // ‰æÜÊ∫ê
                    { wch: 50 },  // Ëã±ÊñáÂè•Â≠ê
                    { wch: 50 }   // ‰∏≠ÊñáÁøªË≠Ø
                ];
                worksheet['!cols'] = columnWidths;

                // Âª∫Á´ãÂ∑•‰ΩúÁ∞ø
                const workbook = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(workbook, worksheet, 'Ë©ûÂΩôÊêúÂ∞ãÁµêÊûú');

                // ‰∏ãËºâÊ™îÊ°à
                const filename = `vocabulary_results_${timestamp}.xlsx`;
                XLSX.writeFile(workbook, filename);

            } catch (error) {
                console.error('ÁîüÊàê Excel Ê™îÊ°àÊôÇÁôºÁîüÈåØË™§:', error);
                alert('ÁîüÊàê Excel Ê™îÊ°àÊôÇÁôºÁîüÈåØË™§ÔºåË´ãÁ®çÂæåÂÜçË©¶');
            }
        }

        // ‰∏ãËºâ Word Ê†ºÂºè (.docx) - Â∞çË©±ÂºèÊéíÂàóÊ†ºÂºè
        function downloadWord(headers, data, timestamp) {
            try {
                // Ê™¢Êü• docx ÊòØÂê¶Â∑≤ËºâÂÖ•
                if (typeof docx === 'undefined' && typeof window.docx === 'undefined') {
                    console.error('docx ÂáΩÂºèÂ∫´Êú™ËºâÂÖ•');
                    alert('Word Êñá‰ª∂ÁîüÊàêÂäüËÉΩÊö´ÊôÇÁÑ°Ê≥ï‰ΩøÁî®ÔºåË´ãÈáçÊñ∞ËºâÂÖ•È†ÅÈù¢ÂæåÂÜçË©¶');
                    return;
                }
                
                // ‰ΩøÁî®Ê≠£Á¢∫ÁöÑ docx ÂèÉËÄÉ
                const docxLib = window.docx || docx;

                // Âª∫Á´ãÊñá‰ª∂ÊÆµËêΩÈô£Âàó
                const paragraphs = [];

                // Êñ∞Â¢ûÊ®ôÈ°å
                paragraphs.push(
                    new docxLib.Paragraph({
                        children: [
                            new docxLib.TextRun({
                                text: "VocabGem Ë©ûÂΩôÂØ∂Áü≥ÊåñÊéòÁµêÊûú",
                                bold: true,
                                size: 32, // 16pt
                            }),
                        ],
                        alignment: docxLib.AlignmentType.CENTER,
                        spacing: {
                            after: 400,
                        },
                    })
                );

                // Êñ∞Â¢ûÁîüÊàêÊôÇÈñì
                const now = new Date();
                const dateStr = now.toLocaleDateString('zh-TW', {
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit'
                });
                paragraphs.push(
                    new docxLib.Paragraph({
                        children: [
                            new docxLib.TextRun({
                                text: `ÁîüÊàêÊôÇÈñìÔºö${dateStr}`,
                                italics: true,
                                size: 20, // 10pt
                            }),
                        ],
                        alignment: docxLib.AlignmentType.CENTER,
                        spacing: {
                            after: 600,
                        },
                    })
                );

                // Êñ∞Â¢ûÁµêÊûúÁ∏ΩÊï∏
                paragraphs.push(
                    new docxLib.Paragraph({
                        children: [
                            new docxLib.TextRun({
                                text: `ÂÖ±ÊâæÂà∞ ${data.length} ÂÄãÂ≠∏Ê∏¨ÁúüÈ°å‰æãÂè•`,
                                bold: true,
                                size: 24, // 12pt
                            }),
                        ],
                        spacing: {
                            after: 400,
                        },
                    })
                );

                // Êñ∞Â¢ûÂàÜÈöîÁ∑ö
                paragraphs.push(
                    new docxLib.Paragraph({
                        children: [
                            new docxLib.TextRun({
                                text: "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê",
                                size: 20,
                            }),
                        ],
                        spacing: {
                            after: 400,
                        },
                    })
                );

                // ÈÅçÊ≠∑ÊØèÁ≠ÜË≥áÊñôÔºå‰ΩøÁî®Â∞çË©±ÂºèÊ†ºÂºè
                data.forEach((item, index) => {
                    // Á∑®ËôüÂíåËã±ÊñáÂè•Â≠ê
                    paragraphs.push(
                        new docxLib.Paragraph({
                            children: [
                                new docxLib.TextRun({
                                    text: `${index + 1}. ‰æãÂè•Ôºö`,
                                    bold: true,
                                    size: 22, // 11pt
                                }),
                                new docxLib.TextRun({
                                    text: item.sentence,
                                    size: 22,
                                }),
                            ],
                            spacing: {
                                after: 200,
                            },
                        })
                    );

                    // ‰∏≠ÊñáÁøªË≠Ø
                    paragraphs.push(
                        new docxLib.Paragraph({
                            children: [
                                new docxLib.TextRun({
                                    text: "   ÁøªË≠ØÔºö",
                                    bold: true,
                                    size: 22,
                                }),
                                new docxLib.TextRun({
                                    text: item.translation,
                                    size: 22,
                                }),
                            ],
                            spacing: {
                                after: 200,
                            },
                        })
                    );

                    // ‰æÜÊ∫êË≥áË®ä
                    paragraphs.push(
                        new docxLib.Paragraph({
                            children: [
                                new docxLib.TextRun({
                                    text: `   „Äê${item.year}Âπ¥ ${item.part} ${item.source}„Äë`,
                                    italics: true,
                                    size: 20,
                                    color: "666666",
                                }),
                            ],
                            spacing: {
                                after: 400,
                            },
                        })
                    );

                    // Â¶ÇÊûú‰∏çÊòØÊúÄÂæå‰∏ÄÁ≠ÜÔºåÂä†ÂÖ•ÂàÜÈöîÁ∑ö
                    if (index < data.length - 1) {
                        paragraphs.push(
                            new docxLib.Paragraph({
                                children: [
                                    new docxLib.TextRun({
                                        text: "",
                                    }),
                                ],
                                spacing: {
                                    after: 200,
                                },
                            })
                        );
                    }
                });

                // Âª∫Á´ãÊñá‰ª∂
                const doc = new docxLib.Document({
                    sections: [{
                        properties: {
                            page: {
                                margin: {
                                    top: 1440, // 1 inch
                                    right: 1440,
                                    bottom: 1440,
                                    left: 1440,
                                },
                            },
                        },
                        children: paragraphs,
                    }],
                });

                // ÁîüÊàê‰∏¶‰∏ãËºâÊ™îÊ°à
                const filename = `vocabulary_results_${timestamp}.docx`;
                docxLib.Packer.toBlob(doc).then(blob => {
                    saveAs(blob, filename);
                }).catch(error => {
                    console.error('ÁîüÊàê Word Ê™îÊ°àÊôÇÁôºÁîüÈåØË™§:', error);
                    alert('ÁîüÊàê Word Ê™îÊ°àÊôÇÁôºÁîüÈåØË™§ÔºåË´ãÁ®çÂæåÂÜçË©¶');
                });

            } catch (error) {
                console.error('ÁîüÊàê Word Ê™îÊ°àÊôÇÁôºÁîüÈåØË™§:', error);
                alert('ÁîüÊàê Word Ê™îÊ°àÊôÇÁôºÁîüÈåØË™§ÔºåË´ãÁ®çÂæåÂÜçË©¶');
            }
        }

        // ÈÄöÁî®‰∏ãËºâÊñá‰ª∂ÂáΩÊï∏
        function downloadFile(content, filename, mimeType) {
            const blob = new Blob([content], { type: mimeType });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }

        // Â∏∂È´ò‰∫ÆÁöÑË≥áÊñôÈ°ØÁ§∫ÂáΩÊï∏
        function displayDataWithHighlight(data, highlightWords) {
            if (data.length === 0) {
                resultsTable.style.display = 'none';
                resultsInfo.style.display = 'none';
                noResults.style.display = 'block';
                return;
            }

            noResults.style.display = 'none';
            resultsTable.style.display = 'table';
            resultsInfo.style.display = 'block';
            resultsCount.textContent = `ÊâæÂà∞ ${data.length} ÂÄãÂ≠∏Ê∏¨ÁúüÈ°å‰æãÂè•`;

            // Ê∏ÖÁ©∫Ë°®Ê†º
            resultsBody.innerHTML = '';

            // Â°´ÂÖÖË≥áÊñô
            data.forEach(item => {
                const row = document.createElement('tr');

                const yearCell = document.createElement('td');
                const yearBadge = document.createElement('span');
                yearBadge.classList.add('year-badge');
                yearBadge.textContent = item.year;
                yearCell.appendChild(yearBadge);
                row.appendChild(yearCell);

                const partCell = document.createElement('td');
                const partBadge = document.createElement('span');
                partBadge.classList.add('part-badge');
                partBadge.textContent = item.part;
                partBadge.title = item.part;
                partCell.appendChild(partBadge);
                row.appendChild(partCell);

                const sourceCell = document.createElement('td');
                sourceCell.textContent = item.source;
                row.appendChild(sourceCell);

                const sentenceCell = document.createElement('td');
                sentenceCell.classList.add('sentence-cell');
                
                // ÂâµÂª∫Âè•Â≠êÂÖßÂÆπÂÆπÂô®
                const sentenceContent = document.createElement('div');
                sentenceContent.classList.add('sentence-content');
                
                // ÂâµÂª∫Âè•Â≠êÊñáÂ≠óÂÆπÂô®
                const sentenceText = document.createElement('div');
                sentenceText.classList.add('sentence-text');
                sentenceText.innerHTML = highlightText(item.sentence, highlightWords);
                
                // ÂâµÂª∫Ë§áË£ΩÊåâÈàï
                const copyButton = document.createElement('button');
                copyButton.classList.add('copy-sentence-btn');
                copyButton.innerHTML = '<span class="material-symbols-outlined">content_copy</span>';
                copyButton.title = 'Ë§áË£Ω‰æãÂè•';
                copyButton.addEventListener('click', () => copySentence(item.sentence, copyButton));
                
                sentenceContent.appendChild(sentenceText);
                sentenceContent.appendChild(copyButton);
                sentenceCell.appendChild(sentenceContent);
                row.appendChild(sentenceCell);

                const translationCell = document.createElement('td');
                translationCell.classList.add('translation-cell');
                translationCell.textContent = item.translation;
                row.appendChild(translationCell);

                resultsBody.appendChild(row);
            });
        }

        // È´ò‰∫ÆÊñáÂ≠óÂáΩÊï∏
        function highlightText(text, words) {
            let highlightedText = text;
            
            words.forEach(word => {
                if (word.length > 0) {
                    const regex = new RegExp(`\\b(${escapeRegExp(word)})\\b`, 'gi');
                    highlightedText = highlightedText.replace(regex, '<span class="word-match">$1</span>');
                }
            });
            
            return highlightedText;
        }

        function displayData(data) {
            if (data.length === 0) {
                resultsTable.style.display = 'none';
                resultsInfo.style.display = 'none';
                noResults.style.display = 'block';
                return;
            }

            noResults.style.display = 'none';
            resultsTable.style.display = 'table';
            resultsInfo.style.display = 'block';
            resultsCount.textContent = `ÊâæÂà∞ ${data.length} ÂÄãÂ≠∏Ê∏¨ÁúüÈ°å‰æãÂè•`;

            // Ê∏ÖÁ©∫Ë°®Ê†º
            resultsBody.innerHTML = '';

            // Â°´ÂÖÖË≥áÊñô
            data.forEach(item => {
                const row = document.createElement('tr');

                const yearCell = document.createElement('td');
                const yearBadge = document.createElement('span');
                yearBadge.classList.add('year-badge');
                yearBadge.textContent = item.year;
                yearCell.appendChild(yearBadge);
                row.appendChild(yearCell);

                const partCell = document.createElement('td');
                const partBadge = document.createElement('span');
                partBadge.classList.add('part-badge');
                partBadge.textContent = item.part;
                partBadge.title = item.part;
                partCell.appendChild(partBadge);
                row.appendChild(partCell);

                const sourceCell = document.createElement('td');
                sourceCell.textContent = item.source;
                row.appendChild(sourceCell);

                const sentenceCell = document.createElement('td');
                sentenceCell.classList.add('sentence-cell');
                
                // ÂâµÂª∫Âè•Â≠êÂÖßÂÆπÂÆπÂô®
                const sentenceContent = document.createElement('div');
                sentenceContent.classList.add('sentence-content');
                
                // ÂâµÂª∫Âè•Â≠êÊñáÂ≠óÂÆπÂô®
                const sentenceText = document.createElement('div');
                sentenceText.classList.add('sentence-text');
                sentenceText.textContent = item.sentence;
                
                // ÂâµÂª∫Ë§áË£ΩÊåâÈàï
                const copyButton = document.createElement('button');
                copyButton.classList.add('copy-sentence-btn');
                copyButton.innerHTML = '<span class="material-symbols-outlined">content_copy</span>';
                copyButton.title = 'Ë§áË£Ω‰æãÂè•';
                copyButton.addEventListener('click', () => copySentence(item.sentence, copyButton));
                
                sentenceContent.appendChild(sentenceText);
                sentenceContent.appendChild(copyButton);
                sentenceCell.appendChild(sentenceContent);
                row.appendChild(sentenceCell);

                const translationCell = document.createElement('td');
                translationCell.classList.add('translation-cell');
                translationCell.textContent = item.translation;
                row.appendChild(translationCell);

                resultsBody.appendChild(row);
            });
        }

        function showLoading(show) {
            loading.style.display = show ? 'block' : 'none';
        }

        function updateStatus(message) {
            statusText.textContent = message;
        }

        function showError(message) {
            errorMessage.textContent = message;
            errorMessage.style.display = 'block';
        }

        // Èò≤ÊäñÂáΩÊï∏
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // ÁßªÈô§ÈÄô‰∫õÂáΩÊï∏ÔºåÂõ†ÁÇ∫ÊàëÂÄë‰ΩøÁî® Apps Script
        // async function fetchGoogleSheetsData() { ... }
        // function parseSheetData(sheetData) { ... }
    </script>

    <footer class="site-footer">
        <p>Âùá‰∏ÄÊïôËÇ≤Âπ≥Âè∞ x ÈÑ≠Âçö‰ªÅËÄÅÂ∏´</p>
    </footer>
</body>
</html>
